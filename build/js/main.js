"use strict";

(function () {
  document.addEventListener("DOMContentLoaded", function () {
    var slides = document.querySelectorAll(".race__item");
    var slideMoveLeft = document.querySelector(".race__nav-left");
    var slideMoveRight = document.querySelector(".race__nav-right");
    var slideCounter = document.querySelector(".race__nav-counter");
    var currentSlide = 0;
    function updateSlider(index) {
      slides.forEach(function (slide) {
        return slide.classList.remove("_active");
      });
      slides[index].classList.add("_active");
      slideCounter.textContent = "".concat(index + 1, "/").concat(slides.length);
    }
    function moveSlide(direction) {
      var currentBolid = slides[currentSlide].querySelector(".race__bolid");
      currentBolid.classList.add("_move");
      var nextSlide = direction === "next" ? currentSlide + 1 : currentSlide - 1;
      if (nextSlide < 0) nextSlide = slides.length - 1;
      if (nextSlide >= slides.length) nextSlide = 0;
      var nextBolid = slides[nextSlide].querySelector(".race__bolid");
      nextBolid.classList.add("_arrive");
      slides[currentSlide].classList.add("_opacity");
      setTimeout(function () {
        currentBolid.classList.remove("_move");
        nextBolid.classList.remove("_arrive");
        currentSlide = nextSlide;
        updateSlider(currentSlide);
        slides.forEach(function (slide) {
          slide.classList.remove("_opacity");
        });
      }, 1500);
    }
    slideMoveLeft.addEventListener("click", function () {
      moveSlide("prev");
      document.querySelector(".race__nav").style.pointerEvents = "none";
      setTimeout(function () {
        document.querySelector(".race__nav").style.pointerEvents = "initial";
      }, 2000);
    });
    slideMoveRight.addEventListener("click", function () {
      moveSlide("next");
      document.querySelector(".race__nav").style.pointerEvents = "none";
      setTimeout(function () {
        document.querySelector(".race__nav").style.pointerEvents = "initial";
      }, 2000);
    });
    updateSlider(currentSlide);
    function startCountdown(endTime) {
      var daysEls = document.querySelectorAll(".timer__days-item");
      var hoursEls = document.querySelectorAll(".timer__hours-item");
      var minutesEls = document.querySelectorAll(".timer__minutes-item");
      function updateTimer() {
        var now = new Date().getTime();
        var timeLeft = endTime - now;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          updateDigits(daysEls, "00");
          updateDigits(hoursEls, "00");
          updateDigits(minutesEls, "00");
          return;
        }
        var days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        var hours = Math.floor(timeLeft / (1000 * 60 * 60) % 24);
        var minutes = Math.floor(timeLeft / (1000 * 60) % 60);
        updateDigits(daysEls, String(days).padStart(2, "0"));
        updateDigits(hoursEls, String(hours).padStart(2, "0"));
        updateDigits(minutesEls, String(minutes).padStart(2, "0"));
      }
      function updateDigits(elements, value) {
        elements[0].textContent = value[0];
        elements[1].textContent = value[1];
      }
      updateTimer();
      var timerInterval = setInterval(updateTimer, 60000);
    }
    var now = new Date();
    var endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59).getTime();
    startCountdown(endOfMonth);
    function startSmoke(carSelector, smokeClass, maxCount, interval, delay, fadeTime, removeDelay) {
      var extraClass = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : '';
      var activeClass = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : false;
      var cars = document.querySelectorAll(carSelector);
      cars.forEach(function (car) {
        if (!car) return;
        console.log(car.parentElement.parentElement.classList.contains("_active"));
        function createSmoke() {
          if (activeClass) {
            if (!car || !car.parentElement.parentElement.classList.contains("_active")) return;
          }
          if (car.querySelectorAll(".".concat(smokeClass).concat(extraClass ? ".".concat(extraClass) : '')).length < maxCount) {
            var smoke = document.createElement('div');
            smoke.classList.add(smokeClass);
            if (extraClass) smoke.classList.add(extraClass);
            car.appendChild(smoke);
            setTimeout(function () {
              return smoke.classList.add("_opacity");
            }, fadeTime);
            setTimeout(function () {
              return smoke.remove();
            }, fadeTime + removeDelay);
          }
        }
        createSmoke();
        setTimeout(createSmoke, delay);
        setInterval(function () {
          createSmoke();
          setTimeout(createSmoke, delay);
        }, interval);
      });
    }
    // startSmoke('.race__bolid-car', 'race__bolid-smoke-front', 4, 900, 500, 100, 800, "", true);
    // startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 8, 900, 500, 100, 800, "", true);
    // startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 4, 900, 500, 100, 800, "_large", true);
    // startSmoke('.welcome__pers-smoke-front', 'front-before', 4, 900, 500, 100, 800, "", false);
    // startSmoke('.welcome__pers-smoke-back', 'front-before', 4, 900, 500, 100, 800, "", false);

    startSmoke('.race__bolid-car', 'race__bolid-smoke-front', 4, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 8, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 4, 900, 500, 200, 1600, "_large", true);
    startSmoke('.welcome__pers-smoke-front', 'front-before', 4, 900, 500, 200, 1600, "", false);
    startSmoke('.welcome__pers-smoke-back', 'front-before', 4, 900, 500, 200, 1600, "", false);
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsInNsaWRlTW92ZUxlZnQiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVNb3ZlUmlnaHQiLCJzbGlkZUNvdW50ZXIiLCJjdXJyZW50U2xpZGUiLCJ1cGRhdGVTbGlkZXIiLCJpbmRleCIsImZvckVhY2giLCJzbGlkZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsInRleHRDb250ZW50IiwibGVuZ3RoIiwibW92ZVNsaWRlIiwiZGlyZWN0aW9uIiwiY3VycmVudEJvbGlkIiwibmV4dFNsaWRlIiwibmV4dEJvbGlkIiwic2V0VGltZW91dCIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInN0YXJ0Q291bnRkb3duIiwiZW5kVGltZSIsImRheXNFbHMiLCJob3Vyc0VscyIsIm1pbnV0ZXNFbHMiLCJ1cGRhdGVUaW1lciIsIm5vdyIsIkRhdGUiLCJnZXRUaW1lIiwidGltZUxlZnQiLCJjbGVhckludGVydmFsIiwidGltZXJJbnRlcnZhbCIsInVwZGF0ZURpZ2l0cyIsImRheXMiLCJNYXRoIiwiZmxvb3IiLCJob3VycyIsIm1pbnV0ZXMiLCJTdHJpbmciLCJwYWRTdGFydCIsImVsZW1lbnRzIiwidmFsdWUiLCJzZXRJbnRlcnZhbCIsImVuZE9mTW9udGgiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwic3RhcnRTbW9rZSIsImNhclNlbGVjdG9yIiwic21va2VDbGFzcyIsIm1heENvdW50IiwiaW50ZXJ2YWwiLCJkZWxheSIsImZhZGVUaW1lIiwicmVtb3ZlRGVsYXkiLCJleHRyYUNsYXNzIiwiYWN0aXZlQ2xhc3MiLCJjYXJzIiwiY2FyIiwiY29uc29sZSIsImxvZyIsInBhcmVudEVsZW1lbnQiLCJjb250YWlucyIsImNyZWF0ZVNtb2tlIiwic21va2UiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiXSwibWFwcGluZ3Mi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S0FBSyxDQUFDO0VBRTlGLENBQUMsQ0FBQztBQUNOLENBQUMsR0FBRyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpe1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+e1xuICAgICAgICBjb25zdCBzbGlkZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJhY2VfX2l0ZW1cIilcbiAgICAgICAgY29uc3Qgc2xpZGVNb3ZlTGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2LWxlZnRcIilcbiAgICAgICAgY29uc3Qgc2xpZGVNb3ZlUmlnaHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdi1yaWdodFwiKVxuICAgICAgICBjb25zdCBzbGlkZUNvdW50ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdi1jb3VudGVyXCIpXG5cbiAgICAgICAgbGV0IGN1cnJlbnRTbGlkZSA9IDBcblxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNsaWRlcihpbmRleCkge1xuICAgICAgICAgICAgc2xpZGVzLmZvckVhY2goc2xpZGUgPT4gc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShcIl9hY3RpdmVcIikpO1xuICAgICAgICAgICAgc2xpZGVzW2luZGV4XS5jbGFzc0xpc3QuYWRkKFwiX2FjdGl2ZVwiKTtcbiAgICAgICAgICAgIHNsaWRlQ291bnRlci50ZXh0Q29udGVudCA9IGAke2luZGV4ICsgMX0vJHtzbGlkZXMubGVuZ3RofWA7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtb3ZlU2xpZGUoZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Qm9saWQgPSBzbGlkZXNbY3VycmVudFNsaWRlXS5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX2JvbGlkXCIpO1xuICAgICAgICAgICAgY3VycmVudEJvbGlkLmNsYXNzTGlzdC5hZGQoXCJfbW92ZVwiKTtcbiAgICAgICAgICAgIGxldCBuZXh0U2xpZGUgPSBkaXJlY3Rpb24gPT09IFwibmV4dFwiID8gY3VycmVudFNsaWRlICsgMSA6IGN1cnJlbnRTbGlkZSAtIDE7XG4gICAgICAgICAgICBpZiAobmV4dFNsaWRlIDwgMCkgbmV4dFNsaWRlID0gc2xpZGVzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICBpZiAobmV4dFNsaWRlID49IHNsaWRlcy5sZW5ndGgpIG5leHRTbGlkZSA9IDA7XG5cbiAgICAgICAgICAgIGNvbnN0IG5leHRCb2xpZCA9IHNsaWRlc1tuZXh0U2xpZGVdLnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fYm9saWRcIik7XG4gICAgICAgICAgICBuZXh0Qm9saWQuY2xhc3NMaXN0LmFkZChcIl9hcnJpdmVcIik7XG5cblxuICAgICAgICAgICAgc2xpZGVzW2N1cnJlbnRTbGlkZV0uY2xhc3NMaXN0LmFkZChcIl9vcGFjaXR5XCIpXG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRCb2xpZC5jbGFzc0xpc3QucmVtb3ZlKFwiX21vdmVcIik7XG4gICAgICAgICAgICAgICAgbmV4dEJvbGlkLmNsYXNzTGlzdC5yZW1vdmUoXCJfYXJyaXZlXCIpO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRTbGlkZSA9IG5leHRTbGlkZTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZVNsaWRlcihjdXJyZW50U2xpZGUpO1xuICAgICAgICAgICAgICAgIHNsaWRlcy5mb3JFYWNoKHNsaWRlID0+e1xuICAgICAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKFwiX29wYWNpdHlcIilcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSwgMTUwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBzbGlkZU1vdmVMZWZ0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBtb3ZlU2xpZGUoXCJwcmV2XCIpXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdlwiKS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdlwiKS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCJcbiAgICAgICAgICAgIH0sIDIwMDApXG4gICAgICAgIH0pO1xuICAgICAgICBzbGlkZU1vdmVSaWdodC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbW92ZVNsaWRlKFwibmV4dFwiKVxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXZcIikuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXZcIikuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiXG4gICAgICAgICAgICB9LCAyMDAwKVxuICAgICAgICB9KTtcblxuICAgICAgICB1cGRhdGVTbGlkZXIoY3VycmVudFNsaWRlKTtcblxuXG5cblxuICAgICAgICBmdW5jdGlvbiBzdGFydENvdW50ZG93bihlbmRUaW1lKSB7XG4gICAgICAgICAgICBjb25zdCBkYXlzRWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50aW1lcl9fZGF5cy1pdGVtXCIpO1xuICAgICAgICAgICAgY29uc3QgaG91cnNFbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRpbWVyX19ob3Vycy1pdGVtXCIpO1xuICAgICAgICAgICAgY29uc3QgbWludXRlc0VscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGltZXJfX21pbnV0ZXMtaXRlbVwiKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVGltZXIoKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZUxlZnQgPSBlbmRUaW1lIC0gbm93O1xuXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVMZWZ0IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKGRheXNFbHMsIFwiMDBcIik7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhob3Vyc0VscywgXCIwMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKG1pbnV0ZXNFbHMsIFwiMDBcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBkYXlzID0gTWF0aC5mbG9vcih0aW1lTGVmdCAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKCh0aW1lTGVmdCAvICgxMDAwICogNjAgKiA2MCkpICUgMjQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKCh0aW1lTGVmdCAvICgxMDAwICogNjApKSAlIDYwKTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhkYXlzRWxzLCBTdHJpbmcoZGF5cykucGFkU3RhcnQoMiwgXCIwXCIpKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMoaG91cnNFbHMsIFN0cmluZyhob3VycykucGFkU3RhcnQoMiwgXCIwXCIpKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMobWludXRlc0VscywgU3RyaW5nKG1pbnV0ZXMpLnBhZFN0YXJ0KDIsIFwiMFwiKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZURpZ2l0cyhlbGVtZW50cywgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50c1swXS50ZXh0Q29udGVudCA9IHZhbHVlWzBdO1xuICAgICAgICAgICAgICAgIGVsZW1lbnRzWzFdLnRleHRDb250ZW50ID0gdmFsdWVbMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVwZGF0ZVRpbWVyKCk7XG4gICAgICAgICAgICBjb25zdCB0aW1lckludGVydmFsID0gc2V0SW50ZXJ2YWwodXBkYXRlVGltZXIsIDYwMDAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGVuZE9mTW9udGggPSBuZXcgRGF0ZShub3cuZ2V0RnVsbFllYXIoKSwgbm93LmdldE1vbnRoKCkgKyAxLCAwLCAyMywgNTkpLmdldFRpbWUoKTtcblxuICAgICAgICBzdGFydENvdW50ZG93bihlbmRPZk1vbnRoKTtcblxuICAgICAgICBmdW5jdGlvbiBzdGFydFNtb2tlKGNhclNlbGVjdG9yLCBzbW9rZUNsYXNzLCBtYXhDb3VudCwgaW50ZXJ2YWwsIGRlbGF5LCBmYWRlVGltZSwgcmVtb3ZlRGVsYXksIGV4dHJhQ2xhc3MgPSAnJywgYWN0aXZlQ2xhc3MgPSBmYWxzZSkge1xuICAgICAgICAgICAgY29uc3QgY2FycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY2FyU2VsZWN0b3IpO1xuICAgICAgICAgICAgY2Fycy5mb3JFYWNoKGNhciA9PntcbiAgICAgICAgICAgICAgICBpZiAoIWNhcikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNhci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiX2FjdGl2ZVwiKSlcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNtb2tlKCkge1xuICAgICAgICAgICAgICAgICAgICBpZihhY3RpdmVDbGFzcyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNhciB8fCAhY2FyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJfYWN0aXZlXCIpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhci5xdWVyeVNlbGVjdG9yQWxsKGAuJHtzbW9rZUNsYXNzfSR7ZXh0cmFDbGFzcyA/IGAuJHtleHRyYUNsYXNzfWAgOiAnJ31gKS5sZW5ndGggPCBtYXhDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc21va2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNtb2tlLmNsYXNzTGlzdC5hZGQoc21va2VDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXh0cmFDbGFzcykgc21va2UuY2xhc3NMaXN0LmFkZChleHRyYUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhci5hcHBlbmRDaGlsZChzbW9rZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHNtb2tlLmNsYXNzTGlzdC5hZGQoXCJfb3BhY2l0eVwiKSwgZmFkZVRpbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBzbW9rZS5yZW1vdmUoKSwgZmFkZVRpbWUgKyByZW1vdmVEZWxheSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY3JlYXRlU21va2UoKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNyZWF0ZVNtb2tlLCBkZWxheSk7XG4gICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVTbW9rZSgpO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNyZWF0ZVNtb2tlLCBkZWxheSk7XG4gICAgICAgICAgICAgICAgfSwgaW50ZXJ2YWwpO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICB9XG4gICAgICAgIC8vIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtZnJvbnQnLCA0LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiXCIsIHRydWUpO1xuICAgICAgICAvLyBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWJhY2snLCA4LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiXCIsIHRydWUpO1xuICAgICAgICAvLyBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWJhY2snLCA0LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiX2xhcmdlXCIsIHRydWUpO1xuICAgICAgICAvLyBzdGFydFNtb2tlKCcud2VsY29tZV9fcGVycy1zbW9rZS1mcm9udCcsICdmcm9udC1iZWZvcmUnLCA0LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiXCIsIGZhbHNlKTtcbiAgICAgICAgLy8gc3RhcnRTbW9rZSgnLndlbGNvbWVfX3BlcnMtc21va2UtYmFjaycsICdmcm9udC1iZWZvcmUnLCA0LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiXCIsIGZhbHNlKTtcblxuXG4gICAgICAgIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtZnJvbnQnLCA0LCA5MDAsIDUwMCwgMjAwLCAxNjAwLCBcIlwiLCB0cnVlKTtcbiAgICAgICAgc3RhcnRTbW9rZSgnLnJhY2VfX2JvbGlkLWNhcicsICdyYWNlX19ib2xpZC1zbW9rZS1iYWNrJywgOCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgdHJ1ZSk7XG4gICAgICAgIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtYmFjaycsIDQsIDkwMCwgNTAwLCAyMDAsIDE2MDAsIFwiX2xhcmdlXCIsIHRydWUpO1xuICAgICAgICBzdGFydFNtb2tlKCcud2VsY29tZV9fcGVycy1zbW9rZS1mcm9udCcsICdmcm9udC1iZWZvcmUnLCA0LCA5MDAsIDUwMCwgMjAwLCAxNjAwLCBcIlwiLCBmYWxzZSk7XG4gICAgICAgIHN0YXJ0U21va2UoJy53ZWxjb21lX19wZXJzLXNtb2tlLWJhY2snLCAnZnJvbnQtYmVmb3JlJywgNCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgZmFsc2UpO1xuXG4gICAgfSlcbn0pKCkiXX0=
