"use strict";

(function () {
  document.addEventListener("DOMContentLoaded", function () {
    var slides = document.querySelectorAll(".race__item");
    var slideMoveLeft = document.querySelector(".race__nav-left");
    var slideMoveRight = document.querySelector(".race__nav-right");
    var slideCounter = document.querySelector(".race__nav-counter");
    var betTables = document.querySelectorAll(".bet__item");
    var resultsFirst = document.querySelector(".results__first");
    var resultsSecond = document.querySelector(".results__second");
    var resultsThird = document.querySelector(".results__third");
    var currentRace = 3;
    slides.forEach(function (slide, i) {
      if (i < currentRace) {
        slide.classList.add("_done");
      }
      if (i > currentRace) {
        slide.classList.add("_lock");
      }
    });
    var currentSlide = currentRace;
    function updateSlider(index) {
      slides.forEach(function (slide) {
        return slide.classList.remove("_active");
      });
      slides[index].classList.add("_active");
      slideCounter.textContent = "".concat(index + 1, "/").concat(slides.length);
      betTables.forEach(function (table) {
        if (currentSlide > currentRace) {
          table.classList.add("_lock");
        }
        if (currentSlide < currentRace) {
          table.classList.add("_done");
        }
        if (currentSlide === currentRace) {
          table.classList.remove("_lock", "_done");
        }
      });
    }
    function moveSlide(direction) {
      var currentBolid = slides[currentSlide].querySelector(".race__bolid");
      currentBolid.classList.add("_move");
      var nextSlide = direction === "next" ? currentSlide + 1 : currentSlide - 1;
      if (nextSlide < 0) nextSlide = slides.length - 1;
      if (nextSlide >= slides.length) nextSlide = 0;
      var nextBolid = slides[nextSlide].querySelector(".race__bolid");
      nextBolid.classList.add("_arrive");
      slides[currentSlide].classList.add("_opacity");
      setTimeout(function () {
        currentBolid.classList.remove("_move");
        nextBolid.classList.remove("_arrive");
        currentSlide = nextSlide;
        updateSlider(currentSlide);
        slides.forEach(function (slide) {
          slide.classList.remove("_opacity");
        });
      }, 1500);
    }
    slideMoveLeft.addEventListener("click", function () {
      moveSlide("prev");
      document.querySelector(".race__nav").style.pointerEvents = "none";
      setTimeout(function () {
        document.querySelector(".race__nav").style.pointerEvents = "initial";
      }, 2000);
    });
    slideMoveRight.addEventListener("click", function () {
      moveSlide("next");
      document.querySelector(".race__nav").style.pointerEvents = "none";
      setTimeout(function () {
        document.querySelector(".race__nav").style.pointerEvents = "initial";
      }, 2000);
    });
    updateSlider(currentSlide);
    function startCountdown(endTime) {
      var daysEls = document.querySelectorAll(".timer__days-item");
      var hoursEls = document.querySelectorAll(".timer__hours-item");
      var minutesEls = document.querySelectorAll(".timer__minutes-item");
      function updateTimer() {
        var now = new Date().getTime();
        var timeLeft = endTime - now;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          updateDigits(daysEls, "00");
          updateDigits(hoursEls, "00");
          updateDigits(minutesEls, "00");
          return;
        }
        var days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        var hours = Math.floor(timeLeft / (1000 * 60 * 60) % 24);
        var minutes = Math.floor(timeLeft / (1000 * 60) % 60);
        updateDigits(daysEls, String(days).padStart(2, "0"));
        updateDigits(hoursEls, String(hours).padStart(2, "0"));
        updateDigits(minutesEls, String(minutes).padStart(2, "0"));
      }
      function updateDigits(elements, value) {
        elements[0].textContent = value[0];
        elements[1].textContent = value[1];
      }
      updateTimer();
      var timerInterval = setInterval(updateTimer, 60000);
    }
    var now = new Date();
    var endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59).getTime();
    startCountdown(endOfMonth);
    function startSmoke(carSelector, smokeClass, maxCount, interval, delay, fadeTime, removeDelay) {
      var extraClass = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : '';
      var activeClass = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : false;
      var cars = document.querySelectorAll(carSelector);
      cars.forEach(function (car) {
        if (!car) return;
        function createSmoke() {
          if (activeClass) {
            if (!car.parentElement || !car.parentElement.parentElement || !car.parentElement.parentElement.classList.contains("_active")) return;
          }
          var extraClassName = extraClass ? ".".concat(extraClass) : '';
          if (car.querySelectorAll(".".concat(smokeClass).concat(extraClassName)).length < maxCount) {
            var smoke = document.createElement('div');
            smoke.classList.add(smokeClass);
            if (extraClass) smoke.classList.add(extraClass);
            car.appendChild(smoke);
            requestAnimationFrame(function () {
              setTimeout(function () {
                return smoke.classList.add("_opacity");
              }, fadeTime);
            });
            setTimeout(function () {
              return smoke.remove();
            }, fadeTime + removeDelay);
          }
        }
        createSmoke();
        setTimeout(function () {
          setInterval(createSmoke, interval);
        }, delay);
      });
    }

    // function startSmoke(carSelector, smokeClass, maxCount, interval, delay, fadeTime, removeDelay, extraClass = '', activeClass = false) {
    //     const cars = document.querySelectorAll(carSelector);
    //     cars.forEach(car =>{
    //         if (!car) return;
    //         console.log(car.parentElement.parentElement.classList.contains("_active"))
    //
    //         function createSmoke() {
    //             if(activeClass){
    //                 if (!car || !car.parentElement.parentElement.classList.contains("_active")) return;
    //             }
    //             if (car.querySelectorAll(`.${smokeClass}${extraClass ? `.${extraClass}` : ''}`).length < maxCount) {
    //                 const smoke = document.createElement('div');
    //                 smoke.classList.add(smokeClass);
    //                 if (extraClass) smoke.classList.add(extraClass);
    //                 car.appendChild(smoke);
    //                 setTimeout(() => smoke.classList.add("_opacity"), fadeTime);
    //                 setTimeout(() => smoke.remove(), fadeTime + removeDelay);
    //             }
    //         }
    //         createSmoke();
    //         setTimeout(createSmoke, delay);
    //         setInterval(() => {
    //             createSmoke();
    //             setTimeout(createSmoke, delay);
    //         }, interval);
    //     })
    //
    // }

    startSmoke('.race__bolid-car', 'race__bolid-smoke-front', 4, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 8, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 4, 900, 500, 200, 1600, "_large", true);
    startSmoke('.welcome__pers-smoke-front', 'front-before', 4, 900, 500, 200, 1600, "", false);
    startSmoke('.welcome__pers-smoke-back', 'front-before', 4, 900, 500, 200, 1600, "", false);
    function setPopups(triggerButton, popupClass) {
      var popupsContainer = document.querySelector('.popups');
      var popup = document.querySelector(".popups__item.".concat(popupClass));
      if (!triggerButton || !popup || !popupsContainer) return;
      triggerButton.addEventListener('click', function () {
        popupsContainer.classList.remove('_opacity');
        popupsContainer.classList.add(popupClass);
        document.body.style.overflow = 'hidden';
      });
      var closeButton = popup.querySelector('.popups__item-close');
      popupsContainer.addEventListener("click", function (e) {
        if (e.target === popupsContainer || e.target === closeButton) {
          closePopup();
        }
      });
      function closePopup() {
        popupsContainer.classList.add('_opacity');
        popupsContainer.classList.remove(popupClass);
        document.body.style.overflow = '';
      }
    }
    setPopups(document.querySelector('.bet__btn-item'), '_betPopup');
    setPopups(document.querySelector('.confirm__upd-btn'), '_confirmPopup');
    setPopups(document.querySelector('.results__popup-btn'), '_resultsPopup');
    function animateOnScroll(element, animationClass, delay) {
      var options = {
        root: null,
        rootMargin: '0px',
        threshold: 0.2
      };
      var observer = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) {
            setTimeout(function () {
              entry.target.classList.add(animationClass);
            }, delay);
          } else {
            entry.target.classList.remove(animationClass);
          }
        });
      }, options);
      observer.observe(element);
    }
    animateOnScroll(resultsFirst.querySelector(".results__top-decor"), "_show", 0);
    animateOnScroll(resultsSecond.querySelector(".results__top-decor"), "_show", 400);
    animateOnScroll(resultsThird.querySelector(".results__top-decor"), "_show", 800);
    animateOnScroll(resultsFirst.querySelector(".results__top-wrap"), "_show", 0);
    animateOnScroll(resultsSecond.querySelector(".results__top-wrap"), "_show", 400);
    animateOnScroll(resultsThird.querySelector(".results__top-wrap"), "_show", 800);
    document.querySelectorAll('.bet__item').forEach(function (item) {
      var wrap = item.querySelector('.bet__wrap');
      var navItems = item.querySelectorAll('.bet__scroll-nav-item');
      var scrollCount = item.querySelector('.bet__scroll-count');
      var firstColumn = item.querySelector('.bet__column');
      var updateScrollStatus = function updateScrollStatus() {
        var scrollLeft = wrap.scrollLeft;
        var isFirstVisible = scrollLeft < firstColumn.clientWidth / 2;
        navItems[0].classList.toggle('_active', isFirstVisible);
        navItems[1].classList.toggle('_active', !isFirstVisible);
        scrollCount.textContent = isFirstVisible ? '1/2' : '2/2';
      };
      wrap.addEventListener('scroll', updateScrollStatus);
      updateScrollStatus();
    });
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsInNsaWRlTW92ZUxlZnQiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVNb3ZlUmlnaHQiLCJzbGlkZUNvdW50ZXIiLCJiZXRUYWJsZXMiLCJyZXN1bHRzRmlyc3QiLCJyZXN1bHRzU2Vjb25kIiwicmVzdWx0c1RoaXJkIiwiY3VycmVudFJhY2UiLCJmb3JFYWNoIiwic2xpZGUiLCJpIiwiY2xhc3NMaXN0IiwiYWRkIiwiY3VycmVudFNsaWRlIiwidXBkYXRlU2xpZGVyIiwiaW5kZXgiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsImxlbmd0aCIsInRhYmxlIiwibW92ZVNsaWRlIiwiZGlyZWN0aW9uIiwiY3VycmVudEJvbGlkIiwibmV4dFNsaWRlIiwibmV4dEJvbGlkIiwic2V0VGltZW91dCIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInN0YXJ0Q291bnRkb3duIiwiZW5kVGltZSIsImRheXNFbHMiLCJob3Vyc0VscyIsIm1pbnV0ZXNFbHMiLCJ1cGRhdGVUaW1lciIsIm5vdyIsIkRhdGUiLCJnZXRUaW1lIiwidGltZUxlZnQiLCJjbGVhckludGVydmFsIiwidGltZXJJbnRlcnZhbCIsInVwZGF0ZURpZ2l0cyIsImRheXMiLCJNYXRoIiwiZmxvb3IiLCJob3VycyIsIm1pbnV0ZXMiLCJTdHJpbmciLCJwYWRTdGFydCIsImVsZW1lbnRzIiwidmFsdWUiLCJzZXRJbnRlcnZhbCIsImVuZE9mTW9udGgiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwic3RhcnRTbW9rZSIsImNhclNlbGVjdG9yIiwic21va2VDbGFzcyIsIm1heENvdW50IiwiaW50ZXJ2YWwiLCJkZWxheSIsImZhZGVUaW1lIiwicmVtb3ZlRGVsYXkiLCJleHRyYUNsYXNzIiwiYWN0aXZlQ2xhc3MiLCJjYXJzIiwiY2FyIiwiY3JlYXRlU21va2UiLCJwYXJlbnRFbGVtZW50IiwiY29udGFpbnMiLCJleHRyYUNsYXNzTmFtZSIsInNtb2tlIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwic2V0UG9wdXBzIiwidHJpZ2dlckJ1dHRvbiIsInBvcHVwQ2xhc3MiLCJwb3B1cHNDb250YWluZXIiLCJwb3B1cCIsImJvZHkiLCJvdmVyZmxvdyIsImNsb3NlQnV0dG9uIiwiZSIsInRhcmdldCIsImNsb3NlUG9wdXAiLCJhbmltYXRlT25TY3JvbGwiLCJlbGVtZW50IiwiYW5pbWF0aW9uQ2xhc3MiLCJvcHRpb25zIiwicm9vdCIsInJvb3RNYXJnaW4iLCJ0aHJlc2hvbGQiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiZW50cmllcyIsImVudHJ5IiwiaXNJbnRlcnNlY3RpbmciLCJvYnNlcnZlIiwiaXRlbSIsIndyYXAiLCJuYXZJdGVtcyIsInNjcm9sbENvdW50IiwiZmlyc3RDb2x1bW4iLCJ1cGRhdGVTY3JvbGxTdGF0dXMiLCJzY3JvbGxMZWZ0IiwiaXNGaXJzdFZpc2libGUiLCJjbGllbnRXaWR0aCIsInRvZ2dsZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFlBQVc7RUFDUkEsUUFBUSxDQUFDQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxZQUFLO0lBQy9DLElBQU1DLE1BQU0sR0FBR0YsUUFBUSxDQUFDRyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUM7SUFDdkQsSUFBTUMsYUFBYSxHQUFHSixRQUFRLENBQUNLLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQztJQUMvRCxJQUFNQyxjQUFjLEdBQUdOLFFBQVEsQ0FBQ0ssYUFBYSxDQUFDLGtCQUFrQixDQUFDO0lBQ2pFLElBQU1FLFlBQVksR0FBR1AsUUFBUSxDQUFDSyxhQUFhLENBQUMsb0JBQW9CLENBQUM7SUFDakUsSUFBTUcsU0FBUyxHQUFHUixRQUFRLENBQUNHLGdCQUFnQixDQUFDLFlBQVksQ0FBQztJQUN6RCxJQUFNTSxZQUFZLEdBQUdULFFBQVEs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Q0FBQyxVQUFBMEYsSUFBSSxFQUFJO01BQ3BELElBQU1DLElBQUksR0FBR0QsSUFBSSxDQUFDbEcsYUFBYSxDQUFDLFlBQVksQ0FBQztNQUM3QyxJQUFNb0csUUFBUSxHQUFHRixJQUFJLENBQUNwRyxnQkFBZ0IsQ0FBQyx1QkFBdUIsQ0FBQztNQUMvRCxJQUFNdUcsV0FBVyxHQUFHSCxJQUFJLENBQUNsRyxhQUFhLENBQUMsb0JBQW9CLENBQUM7TUFDNUQsSUFBTXNHLFdBQVcsR0FBR0osSUFBSSxDQUFDbEcsYUFBYSxDQUFDLGNBQWMsQ0FBQztNQUV0RCxJQUFNdUcsa0JBQWtCLEdBQUcsU0FBckJBLGtCQUFrQixHQUFTO1FBQzdCLElBQU1DLFVBQVUsR0FBR0wsSUFBSSxDQUFDSyxVQUFVO1FBQ2xDLElBQU1DLGNBQWMsR0FBR0QsVUFBVSxHQUFHRixXQUFXLENBQUNJLFdBQVcsR0FBRyxDQUFDO1FBRS9ETixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUN6RixTQUFTLENBQUNnRyxNQUFNLENBQUMsU0FBUyxFQUFFRixjQUFjLENBQUM7UUFDdkRMLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQ3pGLFNBQVMsQ0FBQ2dHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQ0YsY0FBYyxDQUFDO1FBRXhESixXQUFXLENBQUNwRixXQUFXLEdBQUd3RixjQUFjLEdBQUcsS0FBSyxHQUFHLEtBQUs7TUFDNUQsQ0FBQztNQUVETixJQUFJLENBQUN2RyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUyRyxrQkFBa0IsQ0FBQztNQUNuREEsa0JBQWtCLEVBQUU7SUFDeEIsQ0FBQyxDQUFDO0VBSU4sQ0FBQyxDQUFDO0FBQ04sQ0FBQyxHQUFHIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCl7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT57XG4gICAgICAgIGNvbnN0IHNsaWRlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucmFjZV9faXRlbVwiKVxuICAgICAgICBjb25zdCBzbGlkZU1vdmVMZWZ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXYtbGVmdFwiKVxuICAgICAgICBjb25zdCBzbGlkZU1vdmVSaWdodCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2LXJpZ2h0XCIpXG4gICAgICAgIGNvbnN0IHNsaWRlQ291bnRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2LWNvdW50ZXJcIilcbiAgICAgICAgY29uc3QgYmV0VGFibGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5iZXRfX2l0ZW1cIilcbiAgICAgICAgY29uc3QgcmVzdWx0c0ZpcnN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX19maXJzdFwiKVxuICAgICAgICBjb25zdCByZXN1bHRzU2Vjb25kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX19zZWNvbmRcIilcbiAgICAgICAgY29uc3QgcmVzdWx0c1RoaXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190aGlyZFwiKVxuXG4gICAgICAgIGxldCBjdXJyZW50UmFjZSA9IDM7XG5cbiAgICAgICAgc2xpZGVzLmZvckVhY2goKHNsaWRlLCBpKSA9PntcbiAgICAgICAgICAgIGlmKGkgPCBjdXJyZW50UmFjZSl7XG4gICAgICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LmFkZChcIl9kb25lXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihpID4gY3VycmVudFJhY2Upe1xuICAgICAgICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC5hZGQoXCJfbG9ja1wiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG5cbiAgICAgICAgbGV0IGN1cnJlbnRTbGlkZSA9IGN1cnJlbnRSYWNlXG5cblxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNsaWRlcihpbmRleCkge1xuICAgICAgICAgICAgc2xpZGVzLmZvckVhY2goc2xpZGUgPT4gc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShcIl9hY3RpdmVcIikpO1xuICAgICAgICAgICAgc2xpZGVzW2luZGV4XS5jbGFzc0xpc3QuYWRkKFwiX2FjdGl2ZVwiKTtcbiAgICAgICAgICAgIHNsaWRlQ291bnRlci50ZXh0Q29udGVudCA9IGAke2luZGV4ICsgMX0vJHtzbGlkZXMubGVuZ3RofWA7XG4gICAgICAgICAgICBiZXRUYWJsZXMuZm9yRWFjaCh0YWJsZSA9PntcbiAgICAgICAgICAgICAgICBpZihjdXJyZW50U2xpZGUgPiBjdXJyZW50UmFjZSl7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoXCJfbG9ja1wiKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihjdXJyZW50U2xpZGUgPCBjdXJyZW50UmFjZSl7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoXCJfZG9uZVwiKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihjdXJyZW50U2xpZGUgPT09IGN1cnJlbnRSYWNlKXtcbiAgICAgICAgICAgICAgICAgICAgdGFibGUuY2xhc3NMaXN0LnJlbW92ZShcIl9sb2NrXCIsIFwiX2RvbmVcIilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbW92ZVNsaWRlKGRpcmVjdGlvbikge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudEJvbGlkID0gc2xpZGVzW2N1cnJlbnRTbGlkZV0ucXVlcnlTZWxlY3RvcihcIi5yYWNlX19ib2xpZFwiKTtcbiAgICAgICAgICAgIGN1cnJlbnRCb2xpZC5jbGFzc0xpc3QuYWRkKFwiX21vdmVcIik7XG4gICAgICAgICAgICBsZXQgbmV4dFNsaWRlID0gZGlyZWN0aW9uID09PSBcIm5leHRcIiA/IGN1cnJlbnRTbGlkZSArIDEgOiBjdXJyZW50U2xpZGUgLSAxO1xuICAgICAgICAgICAgaWYgKG5leHRTbGlkZSA8IDApIG5leHRTbGlkZSA9IHNsaWRlcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgaWYgKG5leHRTbGlkZSA+PSBzbGlkZXMubGVuZ3RoKSBuZXh0U2xpZGUgPSAwO1xuXG4gICAgICAgICAgICBjb25zdCBuZXh0Qm9saWQgPSBzbGlkZXNbbmV4dFNsaWRlXS5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX2JvbGlkXCIpO1xuICAgICAgICAgICAgbmV4dEJvbGlkLmNsYXNzTGlzdC5hZGQoXCJfYXJyaXZlXCIpO1xuXG5cbiAgICAgICAgICAgIHNsaWRlc1tjdXJyZW50U2xpZGVdLmNsYXNzTGlzdC5hZGQoXCJfb3BhY2l0eVwiKVxuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Qm9saWQuY2xhc3NMaXN0LnJlbW92ZShcIl9tb3ZlXCIpO1xuICAgICAgICAgICAgICAgIG5leHRCb2xpZC5jbGFzc0xpc3QucmVtb3ZlKFwiX2Fycml2ZVwiKTtcbiAgICAgICAgICAgICAgICBjdXJyZW50U2xpZGUgPSBuZXh0U2xpZGU7XG5cbiAgICAgICAgICAgICAgICB1cGRhdGVTbGlkZXIoY3VycmVudFNsaWRlKTtcbiAgICAgICAgICAgICAgICBzbGlkZXMuZm9yRWFjaChzbGlkZSA9PntcbiAgICAgICAgICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShcIl9vcGFjaXR5XCIpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sIDE1MDApO1xuICAgICAgICB9XG5cbiAgICAgICAgc2xpZGVNb3ZlTGVmdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbW92ZVNsaWRlKFwicHJldlwiKVxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXZcIikuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXZcIikuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiXG4gICAgICAgICAgICB9LCAyMDAwKVxuICAgICAgICB9KTtcbiAgICAgICAgc2xpZGVNb3ZlUmlnaHQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgIG1vdmVTbGlkZShcIm5leHRcIilcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2XCIpLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIlxuICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2XCIpLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImluaXRpYWxcIlxuICAgICAgICAgICAgfSwgMjAwMClcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdXBkYXRlU2xpZGVyKGN1cnJlbnRTbGlkZSk7XG5cblxuXG5cbiAgICAgICAgZnVuY3Rpb24gc3RhcnRDb3VudGRvd24oZW5kVGltZSkge1xuICAgICAgICAgICAgY29uc3QgZGF5c0VscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGltZXJfX2RheXMtaXRlbVwiKTtcbiAgICAgICAgICAgIGNvbnN0IGhvdXJzRWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50aW1lcl9faG91cnMtaXRlbVwiKTtcbiAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXNFbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRpbWVyX19taW51dGVzLWl0ZW1cIik7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRpbWVyKCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVMZWZ0ID0gZW5kVGltZSAtIG5vdztcblxuICAgICAgICAgICAgICAgIGlmICh0aW1lTGVmdCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXJJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhkYXlzRWxzLCBcIjAwXCIpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMoaG91cnNFbHMsIFwiMDBcIik7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhtaW51dGVzRWxzLCBcIjAwXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgZGF5cyA9IE1hdGguZmxvb3IodGltZUxlZnQgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcigodGltZUxlZnQgLyAoMTAwMCAqIDYwICogNjApKSAlIDI0KTtcbiAgICAgICAgICAgICAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigodGltZUxlZnQgLyAoMTAwMCAqIDYwKSkgJSA2MCk7XG5cbiAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMoZGF5c0VscywgU3RyaW5nKGRheXMpLnBhZFN0YXJ0KDIsIFwiMFwiKSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKGhvdXJzRWxzLCBTdHJpbmcoaG91cnMpLnBhZFN0YXJ0KDIsIFwiMFwiKSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKG1pbnV0ZXNFbHMsIFN0cmluZyhtaW51dGVzKS5wYWRTdGFydCgyLCBcIjBcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVEaWdpdHMoZWxlbWVudHMsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudHNbMF0udGV4dENvbnRlbnQgPSB2YWx1ZVswXTtcbiAgICAgICAgICAgICAgICBlbGVtZW50c1sxXS50ZXh0Q29udGVudCA9IHZhbHVlWzFdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1cGRhdGVUaW1lcigpO1xuICAgICAgICAgICAgY29uc3QgdGltZXJJbnRlcnZhbCA9IHNldEludGVydmFsKHVwZGF0ZVRpbWVyLCA2MDAwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBlbmRPZk1vbnRoID0gbmV3IERhdGUobm93LmdldEZ1bGxZZWFyKCksIG5vdy5nZXRNb250aCgpICsgMSwgMCwgMjMsIDU5KS5nZXRUaW1lKCk7XG5cbiAgICAgICAgc3RhcnRDb3VudGRvd24oZW5kT2ZNb250aCk7XG5cblxuICAgICAgICBmdW5jdGlvbiBzdGFydFNtb2tlKGNhclNlbGVjdG9yLCBzbW9rZUNsYXNzLCBtYXhDb3VudCwgaW50ZXJ2YWwsIGRlbGF5LCBmYWRlVGltZSwgcmVtb3ZlRGVsYXksIGV4dHJhQ2xhc3MgPSAnJywgYWN0aXZlQ2xhc3MgPSBmYWxzZSkge1xuICAgICAgICAgICAgY29uc3QgY2FycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY2FyU2VsZWN0b3IpO1xuXG4gICAgICAgICAgICBjYXJzLmZvckVhY2goY2FyID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWNhcikgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlU21va2UoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmVDbGFzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjYXIucGFyZW50RWxlbWVudCB8fCAhY2FyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudCB8fCAhY2FyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJfYWN0aXZlXCIpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBleHRyYUNsYXNzTmFtZSA9IGV4dHJhQ2xhc3MgPyBgLiR7ZXh0cmFDbGFzc31gIDogJyc7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYXIucXVlcnlTZWxlY3RvckFsbChgLiR7c21va2VDbGFzc30ke2V4dHJhQ2xhc3NOYW1lfWApLmxlbmd0aCA8IG1heENvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzbW9rZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc21va2UuY2xhc3NMaXN0LmFkZChzbW9rZUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHRyYUNsYXNzKSBzbW9rZS5jbGFzc0xpc3QuYWRkKGV4dHJhQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FyLmFwcGVuZENoaWxkKHNtb2tlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHNtb2tlLmNsYXNzTGlzdC5hZGQoXCJfb3BhY2l0eVwiKSwgZmFkZVRpbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc21va2UucmVtb3ZlKCksIGZhZGVUaW1lICsgcmVtb3ZlRGVsYXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY3JlYXRlU21va2UoKTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzZXRJbnRlcnZhbChjcmVhdGVTbW9rZSwgaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cblxuICAgICAgICAvLyBmdW5jdGlvbiBzdGFydFNtb2tlKGNhclNlbGVjdG9yLCBzbW9rZUNsYXNzLCBtYXhDb3VudCwgaW50ZXJ2YWwsIGRlbGF5LCBmYWRlVGltZSwgcmVtb3ZlRGVsYXksIGV4dHJhQ2xhc3MgPSAnJywgYWN0aXZlQ2xhc3MgPSBmYWxzZSkge1xuICAgICAgICAvLyAgICAgY29uc3QgY2FycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY2FyU2VsZWN0b3IpO1xuICAgICAgICAvLyAgICAgY2Fycy5mb3JFYWNoKGNhciA9PntcbiAgICAgICAgLy8gICAgICAgICBpZiAoIWNhcikgcmV0dXJuO1xuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKGNhci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiX2FjdGl2ZVwiKSlcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgICAgICBmdW5jdGlvbiBjcmVhdGVTbW9rZSgpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgaWYoYWN0aXZlQ2xhc3Mpe1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgaWYgKCFjYXIgfHwgIWNhci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiX2FjdGl2ZVwiKSkgcmV0dXJuO1xuICAgICAgICAvLyAgICAgICAgICAgICB9XG4gICAgICAgIC8vICAgICAgICAgICAgIGlmIChjYXIucXVlcnlTZWxlY3RvckFsbChgLiR7c21va2VDbGFzc30ke2V4dHJhQ2xhc3MgPyBgLiR7ZXh0cmFDbGFzc31gIDogJyd9YCkubGVuZ3RoIDwgbWF4Q291bnQpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGNvbnN0IHNtb2tlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBzbW9rZS5jbGFzc0xpc3QuYWRkKHNtb2tlQ2xhc3MpO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgaWYgKGV4dHJhQ2xhc3MpIHNtb2tlLmNsYXNzTGlzdC5hZGQoZXh0cmFDbGFzcyk7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBjYXIuYXBwZW5kQ2hpbGQoc21va2UpO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBzbW9rZS5jbGFzc0xpc3QuYWRkKFwiX29wYWNpdHlcIiksIGZhZGVUaW1lKTtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc21va2UucmVtb3ZlKCksIGZhZGVUaW1lICsgcmVtb3ZlRGVsYXkpO1xuICAgICAgICAvLyAgICAgICAgICAgICB9XG4gICAgICAgIC8vICAgICAgICAgfVxuICAgICAgICAvLyAgICAgICAgIGNyZWF0ZVNtb2tlKCk7XG4gICAgICAgIC8vICAgICAgICAgc2V0VGltZW91dChjcmVhdGVTbW9rZSwgZGVsYXkpO1xuICAgICAgICAvLyAgICAgICAgIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgLy8gICAgICAgICAgICAgY3JlYXRlU21va2UoKTtcbiAgICAgICAgLy8gICAgICAgICAgICAgc2V0VGltZW91dChjcmVhdGVTbW9rZSwgZGVsYXkpO1xuICAgICAgICAvLyAgICAgICAgIH0sIGludGVydmFsKTtcbiAgICAgICAgLy8gICAgIH0pXG4gICAgICAgIC8vXG4gICAgICAgIC8vIH1cblxuICAgICAgICBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWZyb250JywgNCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgdHJ1ZSk7XG4gICAgICAgIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtYmFjaycsIDgsIDkwMCwgNTAwLCAyMDAsIDE2MDAsIFwiXCIsIHRydWUpO1xuICAgICAgICBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWJhY2snLCA0LCA5MDAsIDUwMCwgMjAwLCAxNjAwLCBcIl9sYXJnZVwiLCB0cnVlKTtcbiAgICAgICAgc3RhcnRTbW9rZSgnLndlbGNvbWVfX3BlcnMtc21va2UtZnJvbnQnLCAnZnJvbnQtYmVmb3JlJywgNCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgZmFsc2UpO1xuICAgICAgICBzdGFydFNtb2tlKCcud2VsY29tZV9fcGVycy1zbW9rZS1iYWNrJywgJ2Zyb250LWJlZm9yZScsIDQsIDkwMCwgNTAwLCAyMDAsIDE2MDAsIFwiXCIsIGZhbHNlKTtcblxuXG4gICAgICAgIGZ1bmN0aW9uIHNldFBvcHVwcyh0cmlnZ2VyQnV0dG9uLCBwb3B1cENsYXNzKSB7XG4gICAgICAgICAgICBjb25zdCBwb3B1cHNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBzJyk7XG4gICAgICAgICAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5wb3B1cHNfX2l0ZW0uJHtwb3B1cENsYXNzfWApO1xuXG4gICAgICAgICAgICBpZiAoIXRyaWdnZXJCdXR0b24gfHwgIXBvcHVwIHx8ICFwb3B1cHNDb250YWluZXIpIHJldHVybjtcblxuICAgICAgICAgICAgdHJpZ2dlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBwb3B1cHNDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnX29wYWNpdHknKTtcbiAgICAgICAgICAgICAgICBwb3B1cHNDb250YWluZXIuY2xhc3NMaXN0LmFkZChwb3B1cENsYXNzKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwc19faXRlbS1jbG9zZScpO1xuXG4gICAgICAgICAgICBwb3B1cHNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PntcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQgPT09IHBvcHVwc0NvbnRhaW5lciB8fCBlLnRhcmdldCA9PT0gY2xvc2VCdXR0b24pe1xuICAgICAgICAgICAgICAgICAgICBjbG9zZVBvcHVwKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBjbG9zZVBvcHVwKCkge1xuICAgICAgICAgICAgICAgIHBvcHVwc0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdfb3BhY2l0eScpO1xuICAgICAgICAgICAgICAgIHBvcHVwc0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKHBvcHVwQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHNldFBvcHVwcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmV0X19idG4taXRlbScpLCAnX2JldFBvcHVwJyk7XG4gICAgICAgIHNldFBvcHVwcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29uZmlybV9fdXBkLWJ0bicpLCAnX2NvbmZpcm1Qb3B1cCcpO1xuICAgICAgICBzZXRQb3B1cHMoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc3VsdHNfX3BvcHVwLWJ0bicpLCAnX3Jlc3VsdHNQb3B1cCcpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGFuaW1hdGVPblNjcm9sbChlbGVtZW50LCBhbmltYXRpb25DbGFzcywgZGVsYXkpIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgcm9vdDogbnVsbCxcbiAgICAgICAgICAgICAgICByb290TWFyZ2luOiAnMHB4JyxcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGQ6IDAuMlxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICAgICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5hZGQoYW5pbWF0aW9uQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZGVsYXkpXG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKGFuaW1hdGlvbkNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCk7XG5cblxuICAgICAgICB9XG5cbiAgICAgICAgYW5pbWF0ZU9uU2Nyb2xsKHJlc3VsdHNGaXJzdC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3RvcC1kZWNvclwiKSwgXCJfc2hvd1wiLCAwKVxuICAgICAgICBhbmltYXRlT25TY3JvbGwocmVzdWx0c1NlY29uZC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3RvcC1kZWNvclwiKSwgXCJfc2hvd1wiLCA0MDApXG4gICAgICAgIGFuaW1hdGVPblNjcm9sbChyZXN1bHRzVGhpcmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3AtZGVjb3JcIiksIFwiX3Nob3dcIiwgODAwKVxuICAgICAgICBhbmltYXRlT25TY3JvbGwocmVzdWx0c0ZpcnN0LnF1ZXJ5U2VsZWN0b3IoXCIucmVzdWx0c19fdG9wLXdyYXBcIiksIFwiX3Nob3dcIiwgMClcbiAgICAgICAgYW5pbWF0ZU9uU2Nyb2xsKHJlc3VsdHNTZWNvbmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3Atd3JhcFwiKSwgXCJfc2hvd1wiLCA0MDApXG4gICAgICAgIGFuaW1hdGVPblNjcm9sbChyZXN1bHRzVGhpcmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3Atd3JhcFwiKSwgXCJfc2hvd1wiLCA4MDApXG5cblxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYmV0X19pdGVtJykuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdyYXAgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5iZXRfX3dyYXAnKTtcbiAgICAgICAgICAgIGNvbnN0IG5hdkl0ZW1zID0gaXRlbS5xdWVyeVNlbGVjdG9yQWxsKCcuYmV0X19zY3JvbGwtbmF2LWl0ZW0nKTtcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbENvdW50ID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuYmV0X19zY3JvbGwtY291bnQnKTtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0Q29sdW1uID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuYmV0X19jb2x1bW4nKTtcblxuICAgICAgICAgICAgY29uc3QgdXBkYXRlU2Nyb2xsU3RhdHVzID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjcm9sbExlZnQgPSB3cmFwLnNjcm9sbExlZnQ7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNGaXJzdFZpc2libGUgPSBzY3JvbGxMZWZ0IDwgZmlyc3RDb2x1bW4uY2xpZW50V2lkdGggLyAyO1xuXG4gICAgICAgICAgICAgICAgbmF2SXRlbXNbMF0uY2xhc3NMaXN0LnRvZ2dsZSgnX2FjdGl2ZScsIGlzRmlyc3RWaXNpYmxlKTtcbiAgICAgICAgICAgICAgICBuYXZJdGVtc1sxXS5jbGFzc0xpc3QudG9nZ2xlKCdfYWN0aXZlJywgIWlzRmlyc3RWaXNpYmxlKTtcblxuICAgICAgICAgICAgICAgIHNjcm9sbENvdW50LnRleHRDb250ZW50ID0gaXNGaXJzdFZpc2libGUgPyAnMS8yJyA6ICcyLzInO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgd3JhcC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB1cGRhdGVTY3JvbGxTdGF0dXMpO1xuICAgICAgICAgICAgdXBkYXRlU2Nyb2xsU3RhdHVzKCk7XG4gICAgICAgIH0pO1xuXG5cblxuICAgIH0pXG59KSgpIl19
