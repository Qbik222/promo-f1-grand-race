"use strict";

(function () {
  document.addEventListener("DOMContentLoaded", function () {
    var slides = document.querySelectorAll(".race__item");
    var slideMoveLeft = document.querySelector(".race__nav-left");
    var slideMoveRight = document.querySelector(".race__nav-right");
    var slideCounter = document.querySelector(".race__nav-counter");
    var betTables = document.querySelectorAll(".bet__item");
    var resultsFirst = document.querySelector(".results__first");
    var resultsSecond = document.querySelector(".results__second");
    var resultsThird = document.querySelector(".results__third");
    var currentRace = 3;
    slides.forEach(function (slide, i) {
      if (i < currentRace) {
        slide.classList.add("_done");
      }
      if (i > currentRace) {
        slide.classList.add("_lock");
      }
    });
    var currentSlide = currentRace;
    function updateSlider(index) {
      slides.forEach(function (slide) {
        return slide.classList.remove("_active");
      });
      slides[index].classList.add("_active");
      slideCounter.textContent = "".concat(index + 1, "/").concat(slides.length);
      betTables.forEach(function (table) {
        if (currentSlide > currentRace) {
          table.classList.add("_lock");
        }
        if (currentSlide < currentRace) {
          table.classList.add("_done");
        }
        if (currentSlide === currentRace) {
          table.classList.remove("_lock", "_done");
        }
      });
    }
    function moveSlide(direction) {
      var currentBolid = slides[currentSlide].querySelector(".race__bolid");
      currentBolid.classList.add("_move");
      var nextSlide = direction === "next" ? currentSlide + 1 : currentSlide - 1;
      if (nextSlide < 0) nextSlide = slides.length - 1;
      if (nextSlide >= slides.length) nextSlide = 0;
      var nextBolid = slides[nextSlide].querySelector(".race__bolid");
      nextBolid.classList.add("_arrive");
      slides[currentSlide].classList.add("_opacity");
      setTimeout(function () {
        currentBolid.classList.remove("_move");
        nextBolid.classList.remove("_arrive");
        currentSlide = nextSlide;
        updateSlider(currentSlide);
        slides.forEach(function (slide) {
          slide.classList.remove("_opacity");
        });
      }, 1500);
    }
    slideMoveLeft.addEventListener("click", function () {
      moveSlide("prev");
      document.querySelector(".race__nav").style.pointerEvents = "none";
      setTimeout(function () {
        document.querySelector(".race__nav").style.pointerEvents = "initial";
      }, 2000);
    });
    slideMoveRight.addEventListener("click", function () {
      moveSlide("next");
      document.querySelector(".race__nav").style.pointerEvents = "none";
      setTimeout(function () {
        document.querySelector(".race__nav").style.pointerEvents = "initial";
      }, 2000);
    });
    updateSlider(currentSlide);
    function startCountdown(endTime) {
      var daysEls = document.querySelectorAll(".timer__days-item");
      var hoursEls = document.querySelectorAll(".timer__hours-item");
      var minutesEls = document.querySelectorAll(".timer__minutes-item");
      function updateTimer() {
        var now = new Date().getTime();
        var timeLeft = endTime - now;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          updateDigits(daysEls, "00");
          updateDigits(hoursEls, "00");
          updateDigits(minutesEls, "00");
          return;
        }
        var days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        var hours = Math.floor(timeLeft / (1000 * 60 * 60) % 24);
        var minutes = Math.floor(timeLeft / (1000 * 60) % 60);
        updateDigits(daysEls, String(days).padStart(2, "0"));
        updateDigits(hoursEls, String(hours).padStart(2, "0"));
        updateDigits(minutesEls, String(minutes).padStart(2, "0"));
      }
      function updateDigits(elements, value) {
        elements[0].textContent = value[0];
        elements[1].textContent = value[1];
      }
      updateTimer();
      var timerInterval = setInterval(updateTimer, 60000);
    }
    var now = new Date();
    var endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59).getTime();
    startCountdown(endOfMonth);
    function startSmoke(carSelector, smokeClass, maxCount, interval, delay, fadeTime, removeDelay) {
      var extraClass = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : '';
      var activeClass = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : false;
      var cars = document.querySelectorAll(carSelector);
      cars.forEach(function (car) {
        if (!car) return;
        console.log(car.parentElement.parentElement.classList.contains("_active"));
        function createSmoke() {
          if (activeClass) {
            if (!car || !car.parentElement.parentElement.classList.contains("_active")) return;
          }
          if (car.querySelectorAll(".".concat(smokeClass).concat(extraClass ? ".".concat(extraClass) : '')).length < maxCount) {
            var smoke = document.createElement('div');
            smoke.classList.add(smokeClass);
            if (extraClass) smoke.classList.add(extraClass);
            car.appendChild(smoke);
            setTimeout(function () {
              return smoke.classList.add("_opacity");
            }, fadeTime);
            setTimeout(function () {
              return smoke.remove();
            }, fadeTime + removeDelay);
          }
        }
        createSmoke();
        setTimeout(createSmoke, delay);
        setInterval(function () {
          createSmoke();
          setTimeout(createSmoke, delay);
        }, interval);
      });
    }
    startSmoke('.race__bolid-car', 'race__bolid-smoke-front', 4, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 8, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 4, 900, 500, 200, 1600, "_large", true);
    startSmoke('.welcome__pers-smoke-front', 'front-before', 4, 900, 500, 200, 1600, "", false);
    startSmoke('.welcome__pers-smoke-back', 'front-before', 4, 900, 500, 200, 1600, "", false);
    function setPopups(triggerButton, popupClass) {
      var popupsContainer = document.querySelector('.popups');
      var popup = document.querySelector(".popups__item.".concat(popupClass));
      if (!triggerButton || !popup || !popupsContainer) return;
      triggerButton.addEventListener('click', function () {
        popupsContainer.classList.remove('_opacity');
        popupsContainer.classList.add(popupClass);
        document.body.style.overflow = 'hidden';
      });
      var closeButton = popup.querySelector('.popups__item-close');
      popupsContainer.addEventListener("click", function (e) {
        if (e.target === popupsContainer || e.target === closeButton) {
          closePopup();
        }
      });
      function closePopup() {
        popupsContainer.classList.add('_opacity');
        popupsContainer.classList.remove(popupClass);
        document.body.style.overflow = '';
      }
    }
    setPopups(document.querySelector('.bet__btn-item'), '_betPopup');
    setPopups(document.querySelector('.confirm__upd-btn'), '_confirmPopup');
    setPopups(document.querySelector('.results__popup-btn'), '_resultsPopup');
    function animateOnScroll(element, animationClass, delay) {
      var options = {
        root: null,
        rootMargin: '0px',
        threshold: 0.2
      };
      var observer = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) {
            setTimeout(function () {
              entry.target.classList.add(animationClass);
            }, delay);
          } else {
            entry.target.classList.remove(animationClass);
          }
        });
      }, options);
      observer.observe(element);
    }
    animateOnScroll(resultsFirst.querySelector(".results__top-decor"), "_show", 0);
    animateOnScroll(resultsSecond.querySelector(".results__top-decor"), "_show", 400);
    animateOnScroll(resultsThird.querySelector(".results__top-decor"), "_show", 800);
    animateOnScroll(resultsFirst.querySelector(".results__top-wrap"), "_show", 0);
    animateOnScroll(resultsSecond.querySelector(".results__top-wrap"), "_show", 400);
    animateOnScroll(resultsThird.querySelector(".results__top-wrap"), "_show", 800);
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsInNsaWRlTW92ZUxlZnQiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVNb3ZlUmlnaHQiLCJzbGlkZUNvdW50ZXIiLCJiZXRUYWJsZXMiLCJyZXN1bHRzRmlyc3QiLCJyZXN1bHRzU2Vjb25kIiwicmVzdWx0c1RoaXJkIiwiY3VycmVudFJhY2UiLCJmb3JFYWNoIiwic2xpZGUiLCJpIiwiY2xhc3NMaXN0IiwiYWRkIiwiY3VycmVudFNsaWRlIiwidXBkYXRlU2xpZGVyIiwiaW5kZXgiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsImxlbmd0aCIsInRhYmxlIiwibW92ZVNsaWRlIiwiZGlyZWN0aW9uIiwiY3VycmVudEJvbGlkIiwibmV4dFNsaWRlIiwibmV4dEJvbGlkIiwic2V0VGltZW91dCIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInN0YXJ0Q291bnRkb3duIiwiZW5kVGltZSIsImRheXNFbHMiLCJob3Vyc0VscyIsIm1pbnV0ZXNFbHMiLCJ1cGRhdGVUaW1lciIsIm5vdyIsIkRhdGUiLCJnZXRUaW1lIiwidGltZUxlZnQiLCJjbGVhckludGVydmFsIiwidGltZXJJbnRlcnZhbCIsInVwZGF0ZURpZ2l0cyIsImRheXMiLCJNYXRoIiwiZmxvb3IiLCJob3VycyIsIm1pbnV0ZXMiLCJTdHJpbmciLCJwYWRTdGFydCIsImVsZW1lbnRzIiwidmFsdWUiLCJzZXRJbnRlcnZhbCIsImVuZE9mTW9udGgiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwic3RhcnRTbW9rZSIsImNhclNlbGVjdG9yIiwic21va2VDbGFzcyIsIm1heENvdW50IiwiaW50ZXJ2YWwiLCJkZWxheSIsImZhZGVUaW1lIiwicmVtb3ZlRGVsYXkiLCJleHRyYUNsYXNzIiwiYWN0aXZlQ2xhc3MiLCJjYXJzIiwiY2FyIiwiY29uc29sZSIsImxvZyIsInBhcmVudEVsZW1lbnQiLCJjb250YWlucyIsImNyZWF0ZVNtb2tlIiwic21va2UiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJzZXRQb3B1cHMiLCJ0cmlnZ2VyQnV0dG9uIiwicG9wdXBDbGFzcyIsInBvcHVwc0NvbnRhaW5lciIsInBvcHVwIiwiYm9keSIsIm92ZXJmbG93IiwiY2xvc2VCdXR0b24iLCJlIiwidGFyZ2V0IiwiY2xvc2VQb3B1cCIsImFuaW1hdGVPblNjcm9sbCIsImVsZW1lbnQiLCJhbmltYXRpb25DbGFzcyIsIm9wdGlvbnMiLCJyb290Iiwicm9vdE1hcmdpbiIsInRocmVzaG9sZCIsIm9ic2VydmVyIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJlbnRyaWVzIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsIm9ic2VydmUiXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxZQUFXO0VBQ1JBLFFBQVEsQ0FBQ0MsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsWUFBSztJQUMvQyxJQUFNQyxNQUFNLEdBQUdGLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMsYUFBYSxDQUFDO0lBQ3ZELElBQU1DLGFBQWEsR0FBR0osUUFBUSxDQUFDSyxhQUFhLENBQUMsaUJBQWlCLENBQUM7SUFDL0QsSUFBTUMsY0FBYyxHQUFHTixRQUFRLENBQUNLLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQztJQUNqRSxJQUFNRSxZQUFZLEdBQUdQLFFBQVEsQ0FBQ0ssYUFBYSxDQUFDLG9CQUFvQixDQUFDO0lBQ2pFLElBQU1HLFNBQVMsR0FBR1IsUUFBUSxDQUFDRyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUM7SUFDekQsSUFBTU0sWUFBWSxHQUFHVCxRQUFRLENBQUNLLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQztJQUM5RCxJQUFNSyxhQUFhLEdBQUdWLFFBQVEsQ0FBQ0ssYUFBYSxDQUFDLGtCQUFrQixDQUFDO0lBQ2hFLElBQU1NLFlBQVksR0FBR1gsUUFBUSxDQUFDSyxhQUFhLENBQUMsaUJBQWlCLENBQUM7SUFFOUQsSUFBSU8s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QUN4RSxTQUFTLENBQUNLLE1BQU0sQ0FBQ3VFLGNBQWMsQ0FBQztVQUNqRDtRQUNKLENBQUMsQ0FBQztNQUNOLENBQUMsRUFBRUMsT0FBTyxDQUFDO01BRVhJLFFBQVEsQ0FBQ0ssT0FBTyxDQUFDWCxPQUFPLENBQUM7SUFHN0I7SUFFQUQsZUFBZSxDQUFDakYsWUFBWSxDQUFDSixhQUFhLENBQUMscUJBQXFCLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQzlFcUYsZUFBZSxDQUFDaEYsYUFBYSxDQUFDTCxhQUFhLENBQUMscUJBQXFCLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxDQUFDO0lBQ2pGcUYsZUFBZSxDQUFDL0UsWUFBWSxDQUFDTixhQUFhLENBQUMscUJBQXFCLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxDQUFDO0lBQ2hGcUYsZUFBZSxDQUFDakYsWUFBWSxDQUFDSixhQUFhLENBQUMsb0JBQW9CLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQzdFcUYsZUFBZSxDQUFDaEYsYUFBYSxDQUFDTCxhQUFhLENBQUMsb0JBQW9CLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxDQUFDO0lBQ2hGcUYsZUFBZSxDQUFDL0UsWUFBWSxDQUFDTixhQUFhLENBQUMsb0JBQW9CLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxDQUFDO0VBR25GLENBQUMsQ0FBQztBQUNOLENBQUMsR0FBRyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpe1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+e1xuICAgICAgICBjb25zdCBzbGlkZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJhY2VfX2l0ZW1cIilcbiAgICAgICAgY29uc3Qgc2xpZGVNb3ZlTGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2LWxlZnRcIilcbiAgICAgICAgY29uc3Qgc2xpZGVNb3ZlUmlnaHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdi1yaWdodFwiKVxuICAgICAgICBjb25zdCBzbGlkZUNvdW50ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdi1jb3VudGVyXCIpXG4gICAgICAgIGNvbnN0IGJldFRhYmxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYmV0X19pdGVtXCIpXG4gICAgICAgIGNvbnN0IHJlc3VsdHNGaXJzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmVzdWx0c19fZmlyc3RcIilcbiAgICAgICAgY29uc3QgcmVzdWx0c1NlY29uZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmVzdWx0c19fc2Vjb25kXCIpXG4gICAgICAgIGNvbnN0IHJlc3VsdHNUaGlyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmVzdWx0c19fdGhpcmRcIilcblxuICAgICAgICBsZXQgY3VycmVudFJhY2UgPSAzO1xuXG4gICAgICAgIHNsaWRlcy5mb3JFYWNoKChzbGlkZSwgaSkgPT57XG4gICAgICAgICAgICBpZihpIDwgY3VycmVudFJhY2Upe1xuICAgICAgICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC5hZGQoXCJfZG9uZVwiKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoaSA+IGN1cnJlbnRSYWNlKXtcbiAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QuYWRkKFwiX2xvY2tcIilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuXG4gICAgICAgIGxldCBjdXJyZW50U2xpZGUgPSBjdXJyZW50UmFjZVxuXG5cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVTbGlkZXIoaW5kZXgpIHtcbiAgICAgICAgICAgIHNsaWRlcy5mb3JFYWNoKHNsaWRlID0+IHNsaWRlLmNsYXNzTGlzdC5yZW1vdmUoXCJfYWN0aXZlXCIpKTtcbiAgICAgICAgICAgIHNsaWRlc1tpbmRleF0uY2xhc3NMaXN0LmFkZChcIl9hY3RpdmVcIik7XG4gICAgICAgICAgICBzbGlkZUNvdW50ZXIudGV4dENvbnRlbnQgPSBgJHtpbmRleCArIDF9LyR7c2xpZGVzLmxlbmd0aH1gO1xuICAgICAgICAgICAgYmV0VGFibGVzLmZvckVhY2godGFibGUgPT57XG4gICAgICAgICAgICAgICAgaWYoY3VycmVudFNsaWRlID4gY3VycmVudFJhY2Upe1xuICAgICAgICAgICAgICAgICAgICB0YWJsZS5jbGFzc0xpc3QuYWRkKFwiX2xvY2tcIilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoY3VycmVudFNsaWRlIDwgY3VycmVudFJhY2Upe1xuICAgICAgICAgICAgICAgICAgICB0YWJsZS5jbGFzc0xpc3QuYWRkKFwiX2RvbmVcIilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoY3VycmVudFNsaWRlID09PSBjdXJyZW50UmFjZSl7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLmNsYXNzTGlzdC5yZW1vdmUoXCJfbG9ja1wiLCBcIl9kb25lXCIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG1vdmVTbGlkZShkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCb2xpZCA9IHNsaWRlc1tjdXJyZW50U2xpZGVdLnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fYm9saWRcIik7XG4gICAgICAgICAgICBjdXJyZW50Qm9saWQuY2xhc3NMaXN0LmFkZChcIl9tb3ZlXCIpO1xuICAgICAgICAgICAgbGV0IG5leHRTbGlkZSA9IGRpcmVjdGlvbiA9PT0gXCJuZXh0XCIgPyBjdXJyZW50U2xpZGUgKyAxIDogY3VycmVudFNsaWRlIC0gMTtcbiAgICAgICAgICAgIGlmIChuZXh0U2xpZGUgPCAwKSBuZXh0U2xpZGUgPSBzbGlkZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIGlmIChuZXh0U2xpZGUgPj0gc2xpZGVzLmxlbmd0aCkgbmV4dFNsaWRlID0gMDtcblxuICAgICAgICAgICAgY29uc3QgbmV4dEJvbGlkID0gc2xpZGVzW25leHRTbGlkZV0ucXVlcnlTZWxlY3RvcihcIi5yYWNlX19ib2xpZFwiKTtcbiAgICAgICAgICAgIG5leHRCb2xpZC5jbGFzc0xpc3QuYWRkKFwiX2Fycml2ZVwiKTtcblxuXG4gICAgICAgICAgICBzbGlkZXNbY3VycmVudFNsaWRlXS5jbGFzc0xpc3QuYWRkKFwiX29wYWNpdHlcIilcblxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY3VycmVudEJvbGlkLmNsYXNzTGlzdC5yZW1vdmUoXCJfbW92ZVwiKTtcbiAgICAgICAgICAgICAgICBuZXh0Qm9saWQuY2xhc3NMaXN0LnJlbW92ZShcIl9hcnJpdmVcIik7XG4gICAgICAgICAgICAgICAgY3VycmVudFNsaWRlID0gbmV4dFNsaWRlO1xuXG4gICAgICAgICAgICAgICAgdXBkYXRlU2xpZGVyKGN1cnJlbnRTbGlkZSk7XG4gICAgICAgICAgICAgICAgc2xpZGVzLmZvckVhY2goc2xpZGUgPT57XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC5yZW1vdmUoXCJfb3BhY2l0eVwiKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9LCAxNTAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNsaWRlTW92ZUxlZnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgIG1vdmVTbGlkZShcInByZXZcIilcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2XCIpLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIlxuICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2XCIpLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImluaXRpYWxcIlxuICAgICAgICAgICAgfSwgMjAwMClcbiAgICAgICAgfSk7XG4gICAgICAgIHNsaWRlTW92ZVJpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBtb3ZlU2xpZGUoXCJuZXh0XCIpXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdlwiKS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdlwiKS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCJcbiAgICAgICAgICAgIH0sIDIwMDApXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHVwZGF0ZVNsaWRlcihjdXJyZW50U2xpZGUpO1xuXG5cblxuXG4gICAgICAgIGZ1bmN0aW9uIHN0YXJ0Q291bnRkb3duKGVuZFRpbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IGRheXNFbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRpbWVyX19kYXlzLWl0ZW1cIik7XG4gICAgICAgICAgICBjb25zdCBob3Vyc0VscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGltZXJfX2hvdXJzLWl0ZW1cIik7XG4gICAgICAgICAgICBjb25zdCBtaW51dGVzRWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50aW1lcl9fbWludXRlcy1pdGVtXCIpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVUaW1lcigpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lTGVmdCA9IGVuZFRpbWUgLSBub3c7XG5cbiAgICAgICAgICAgICAgICBpZiAodGltZUxlZnQgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVySW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMoZGF5c0VscywgXCIwMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKGhvdXJzRWxzLCBcIjAwXCIpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMobWludXRlc0VscywgXCIwMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKHRpbWVMZWZ0IC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IoKHRpbWVMZWZ0IC8gKDEwMDAgKiA2MCAqIDYwKSkgJSAyNCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IoKHRpbWVMZWZ0IC8gKDEwMDAgKiA2MCkpICUgNjApO1xuXG4gICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKGRheXNFbHMsIFN0cmluZyhkYXlzKS5wYWRTdGFydCgyLCBcIjBcIikpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhob3Vyc0VscywgU3RyaW5nKGhvdXJzKS5wYWRTdGFydCgyLCBcIjBcIikpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhtaW51dGVzRWxzLCBTdHJpbmcobWludXRlcykucGFkU3RhcnQoMiwgXCIwXCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlRGlnaXRzKGVsZW1lbnRzLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnRzWzBdLnRleHRDb250ZW50ID0gdmFsdWVbMF07XG4gICAgICAgICAgICAgICAgZWxlbWVudHNbMV0udGV4dENvbnRlbnQgPSB2YWx1ZVsxXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdXBkYXRlVGltZXIoKTtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVySW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh1cGRhdGVUaW1lciwgNjAwMDApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgZW5kT2ZNb250aCA9IG5ldyBEYXRlKG5vdy5nZXRGdWxsWWVhcigpLCBub3cuZ2V0TW9udGgoKSArIDEsIDAsIDIzLCA1OSkuZ2V0VGltZSgpO1xuXG4gICAgICAgIHN0YXJ0Q291bnRkb3duKGVuZE9mTW9udGgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIHN0YXJ0U21va2UoY2FyU2VsZWN0b3IsIHNtb2tlQ2xhc3MsIG1heENvdW50LCBpbnRlcnZhbCwgZGVsYXksIGZhZGVUaW1lLCByZW1vdmVEZWxheSwgZXh0cmFDbGFzcyA9ICcnLCBhY3RpdmVDbGFzcyA9IGZhbHNlKSB7XG4gICAgICAgICAgICBjb25zdCBjYXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjYXJTZWxlY3Rvcik7XG4gICAgICAgICAgICBjYXJzLmZvckVhY2goY2FyID0+e1xuICAgICAgICAgICAgICAgIGlmICghY2FyKSByZXR1cm47XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coY2FyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJfYWN0aXZlXCIpKVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlU21va2UoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGFjdGl2ZUNsYXNzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2FyIHx8ICFjYXIucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcIl9hY3RpdmVcIikpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FyLnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke3Ntb2tlQ2xhc3N9JHtleHRyYUNsYXNzID8gYC4ke2V4dHJhQ2xhc3N9YCA6ICcnfWApLmxlbmd0aCA8IG1heENvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzbW9rZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc21va2UuY2xhc3NMaXN0LmFkZChzbW9rZUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHRyYUNsYXNzKSBzbW9rZS5jbGFzc0xpc3QuYWRkKGV4dHJhQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FyLmFwcGVuZENoaWxkKHNtb2tlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc21va2UuY2xhc3NMaXN0LmFkZChcIl9vcGFjaXR5XCIpLCBmYWRlVGltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHNtb2tlLnJlbW92ZSgpLCBmYWRlVGltZSArIHJlbW92ZURlbGF5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjcmVhdGVTbW9rZSgpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoY3JlYXRlU21va2UsIGRlbGF5KTtcbiAgICAgICAgICAgICAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVNtb2tlKCk7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoY3JlYXRlU21va2UsIGRlbGF5KTtcbiAgICAgICAgICAgICAgICB9LCBpbnRlcnZhbCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH1cblxuICAgICAgICBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWZyb250JywgNCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgdHJ1ZSk7XG4gICAgICAgIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtYmFjaycsIDgsIDkwMCwgNTAwLCAyMDAsIDE2MDAsIFwiXCIsIHRydWUpO1xuICAgICAgICBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWJhY2snLCA0LCA5MDAsIDUwMCwgMjAwLCAxNjAwLCBcIl9sYXJnZVwiLCB0cnVlKTtcbiAgICAgICAgc3RhcnRTbW9rZSgnLndlbGNvbWVfX3BlcnMtc21va2UtZnJvbnQnLCAnZnJvbnQtYmVmb3JlJywgNCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgZmFsc2UpO1xuICAgICAgICBzdGFydFNtb2tlKCcud2VsY29tZV9fcGVycy1zbW9rZS1iYWNrJywgJ2Zyb250LWJlZm9yZScsIDQsIDkwMCwgNTAwLCAyMDAsIDE2MDAsIFwiXCIsIGZhbHNlKTtcblxuXG4gICAgICAgIGZ1bmN0aW9uIHNldFBvcHVwcyh0cmlnZ2VyQnV0dG9uLCBwb3B1cENsYXNzKSB7XG4gICAgICAgICAgICBjb25zdCBwb3B1cHNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBzJyk7XG4gICAgICAgICAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5wb3B1cHNfX2l0ZW0uJHtwb3B1cENsYXNzfWApO1xuXG4gICAgICAgICAgICBpZiAoIXRyaWdnZXJCdXR0b24gfHwgIXBvcHVwIHx8ICFwb3B1cHNDb250YWluZXIpIHJldHVybjtcblxuICAgICAgICAgICAgdHJpZ2dlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBwb3B1cHNDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnX29wYWNpdHknKTtcbiAgICAgICAgICAgICAgICBwb3B1cHNDb250YWluZXIuY2xhc3NMaXN0LmFkZChwb3B1cENsYXNzKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwc19faXRlbS1jbG9zZScpO1xuXG4gICAgICAgICAgICBwb3B1cHNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PntcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQgPT09IHBvcHVwc0NvbnRhaW5lciB8fCBlLnRhcmdldCA9PT0gY2xvc2VCdXR0b24pe1xuICAgICAgICAgICAgICAgICAgICBjbG9zZVBvcHVwKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBjbG9zZVBvcHVwKCkge1xuICAgICAgICAgICAgICAgIHBvcHVwc0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdfb3BhY2l0eScpO1xuICAgICAgICAgICAgICAgIHBvcHVwc0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKHBvcHVwQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHNldFBvcHVwcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmV0X19idG4taXRlbScpLCAnX2JldFBvcHVwJyk7XG4gICAgICAgIHNldFBvcHVwcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29uZmlybV9fdXBkLWJ0bicpLCAnX2NvbmZpcm1Qb3B1cCcpO1xuICAgICAgICBzZXRQb3B1cHMoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc3VsdHNfX3BvcHVwLWJ0bicpLCAnX3Jlc3VsdHNQb3B1cCcpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGFuaW1hdGVPblNjcm9sbChlbGVtZW50LCBhbmltYXRpb25DbGFzcywgZGVsYXkpIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgcm9vdDogbnVsbCxcbiAgICAgICAgICAgICAgICByb290TWFyZ2luOiAnMHB4JyxcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGQ6IDAuMlxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICAgICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5hZGQoYW5pbWF0aW9uQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZGVsYXkpXG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKGFuaW1hdGlvbkNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCk7XG5cblxuICAgICAgICB9XG5cbiAgICAgICAgYW5pbWF0ZU9uU2Nyb2xsKHJlc3VsdHNGaXJzdC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3RvcC1kZWNvclwiKSwgXCJfc2hvd1wiLCAwKVxuICAgICAgICBhbmltYXRlT25TY3JvbGwocmVzdWx0c1NlY29uZC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3RvcC1kZWNvclwiKSwgXCJfc2hvd1wiLCA0MDApXG4gICAgICAgIGFuaW1hdGVPblNjcm9sbChyZXN1bHRzVGhpcmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3AtZGVjb3JcIiksIFwiX3Nob3dcIiwgODAwKVxuICAgICAgICBhbmltYXRlT25TY3JvbGwocmVzdWx0c0ZpcnN0LnF1ZXJ5U2VsZWN0b3IoXCIucmVzdWx0c19fdG9wLXdyYXBcIiksIFwiX3Nob3dcIiwgMClcbiAgICAgICAgYW5pbWF0ZU9uU2Nyb2xsKHJlc3VsdHNTZWNvbmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3Atd3JhcFwiKSwgXCJfc2hvd1wiLCA0MDApXG4gICAgICAgIGFuaW1hdGVPblNjcm9sbChyZXN1bHRzVGhpcmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3Atd3JhcFwiKSwgXCJfc2hvd1wiLCA4MDApXG5cblxuICAgIH0pXG59KSgpIl19
