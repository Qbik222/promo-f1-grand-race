"use strict";

(function () {
  document.addEventListener("DOMContentLoaded", function () {
    var slides = document.querySelectorAll(".race__item");
    var slideMoveLeft = document.querySelector(".race__nav-left");
    var slideMoveRight = document.querySelector(".race__nav-right");
    var slideCounter = document.querySelector(".race__nav-counter");
    var betTables = document.querySelectorAll(".bet__item");
    var resultsFirst = document.querySelector(".results__first");
    var resultsSecond = document.querySelector(".results__second");
    var resultsThird = document.querySelector(".results__third");
    var currentRace = 3;
    slides.forEach(function (slide, i) {
      if (i < currentRace) {
        slide.classList.add("_done");
      }
      if (i > currentRace) {
        slide.classList.add("_lock");
      }
    });
    var currentSlide = currentRace;
    function updateSlider(index) {
      slides.forEach(function (slide) {
        return slide.classList.remove("_active");
      });
      slides[index].classList.add("_active");
      slideCounter.textContent = "".concat(index + 1, "/").concat(slides.length);
      betTables.forEach(function (table) {
        if (currentSlide > currentRace) {
          table.classList.add("_lock");
        }
        if (currentSlide < currentRace) {
          table.classList.add("_done");
        }
        if (currentSlide === currentRace) {
          table.classList.remove("_lock", "_done");
        }
      });
    }
    function moveSlide(direction) {
      var currentBolid = slides[currentSlide].querySelector(".race__bolid");
      currentBolid.classList.add("_move");
      var nextSlide = direction === "next" ? currentSlide + 1 : currentSlide - 1;
      if (nextSlide < 0) nextSlide = slides.length - 1;
      if (nextSlide >= slides.length) nextSlide = 0;
      var nextBolid = slides[nextSlide].querySelector(".race__bolid");
      nextBolid.classList.add("_arrive");
      slides[currentSlide].classList.add("_opacity");
      setTimeout(function () {
        currentBolid.classList.remove("_move");
        nextBolid.classList.remove("_arrive");
        currentSlide = nextSlide;
        updateSlider(currentSlide);
        slides.forEach(function (slide) {
          slide.classList.remove("_opacity");
        });
      }, 1500);
    }
    slideMoveLeft.addEventListener("click", function () {
      moveSlide("prev");
      document.querySelector(".race__nav").style.pointerEvents = "none";
      setTimeout(function () {
        document.querySelector(".race__nav").style.pointerEvents = "initial";
      }, 2000);
    });
    slideMoveRight.addEventListener("click", function () {
      moveSlide("next");
      document.querySelector(".race__nav").style.pointerEvents = "none";
      setTimeout(function () {
        document.querySelector(".race__nav").style.pointerEvents = "initial";
      }, 2000);
    });
    updateSlider(currentSlide);
    function startCountdown(endTime) {
      var daysEls = document.querySelectorAll(".timer__days-item");
      var hoursEls = document.querySelectorAll(".timer__hours-item");
      var minutesEls = document.querySelectorAll(".timer__minutes-item");
      function updateTimer() {
        var now = new Date().getTime();
        var timeLeft = endTime - now;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          updateDigits(daysEls, "00");
          updateDigits(hoursEls, "00");
          updateDigits(minutesEls, "00");
          return;
        }
        var days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        var hours = Math.floor(timeLeft / (1000 * 60 * 60) % 24);
        var minutes = Math.floor(timeLeft / (1000 * 60) % 60);
        updateDigits(daysEls, String(days).padStart(2, "0"));
        updateDigits(hoursEls, String(hours).padStart(2, "0"));
        updateDigits(minutesEls, String(minutes).padStart(2, "0"));
      }
      function updateDigits(elements, value) {
        elements[0].textContent = value[0];
        elements[1].textContent = value[1];
      }
      updateTimer();
      var timerInterval = setInterval(updateTimer, 60000);
    }
    var now = new Date();
    var endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59).getTime();
    startCountdown(endOfMonth);

    // function startSmoke(carSelector, smokeClass, maxCount, interval, delay, fadeTime, removeDelay, extraClass = '', activeClass = false) {
    //     const cars = document.querySelectorAll(carSelector);
    //
    //     cars.forEach(car => {
    //         if (!car) return;
    //
    //         function createSmoke() {
    //             if (activeClass) {
    //                 if (!car.parentElement || !car.parentElement.parentElement || !car.parentElement.parentElement.classList.contains("_active")) return;
    //             }
    //
    //             const extraClassName = extraClass ? `.${extraClass}` : '';
    //             if (car.querySelectorAll(`.${smokeClass}${extraClassName}`).length < maxCount) {
    //                 const smoke = document.createElement('div');
    //                 smoke.classList.add(smokeClass);
    //                 if (extraClass) smoke.classList.add(extraClass);
    //                 car.appendChild(smoke);
    //
    //                 requestAnimationFrame(() => {
    //                     setTimeout(() => smoke.classList.add("_opacity"), fadeTime);
    //                 });
    //
    //                 setTimeout(() => smoke.remove(), fadeTime + removeDelay);
    //             }
    //         }
    //
    //         createSmoke();
    //
    //         setTimeout(() => {
    //             setInterval(createSmoke, interval);
    //         }, delay);
    //     });
    // }

    function startSmoke(carSelector, smokeClass, maxCount, interval, delay, fadeTime, removeDelay) {
      var extraClass = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : '';
      var activeClass = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : false;
      var cars = document.querySelectorAll(carSelector);
      cars.forEach(function (car) {
        if (!car) return;
        function createSmoke() {
          if (activeClass) {
            var _car$parentElement;
            var parent = (_car$parentElement = car.parentElement) === null || _car$parentElement === void 0 ? void 0 : _car$parentElement.parentElement;
            if (!parent || !parent.classList.contains("_active")) return;
          }
          var extraClassName = extraClass ? ".".concat(extraClass) : '';
          if (car.querySelectorAll(".".concat(smokeClass).concat(extraClassName)).length < maxCount) {
            var smoke = document.createElement('div');
            smoke.classList.add(smokeClass);
            if (extraClass) smoke.classList.add(extraClass);
            car.appendChild(smoke);
            setTimeout(function () {
              return smoke.remove();
            }, fadeTime + removeDelay);
          }
        }
        setTimeout(function () {
          createSmoke();
          setInterval(createSmoke, interval);
        }, delay);
      });
    }
    startSmoke('.race__bolid-car', 'race__bolid-smoke-front', 4, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 8, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 4, 900, 500, 200, 1600, "_large", true);
    startSmoke('.welcome__pers-smoke-front', 'front-before', 4, 900, 500, 200, 1600, "", false);
    startSmoke('.welcome__pers-smoke-back', 'front-before', 4, 900, 500, 200, 1600, "", false);
    function setPopups(triggerButton, popupClass) {
      var popupsContainer = document.querySelector('.popups');
      var popup = document.querySelector(".popups__item.".concat(popupClass));
      if (!triggerButton || !popup || !popupsContainer) return;
      triggerButton.addEventListener('click', function () {
        popupsContainer.classList.remove('_opacity');
        popupsContainer.classList.add(popupClass);
        document.body.style.overflow = 'hidden';
      });
      var closeButton = popup.querySelector('.popups__item-close');
      popupsContainer.addEventListener("click", function (e) {
        if (e.target === popupsContainer || e.target === closeButton) {
          closePopup();
        }
      });
      function closePopup() {
        popupsContainer.classList.add('_opacity');
        popupsContainer.classList.remove(popupClass);
        document.body.style.overflow = '';
      }
    }
    setPopups(document.querySelector('.bet__btn-item'), '_betPopup');
    setPopups(document.querySelector('.confirm__upd-btn'), '_confirmPopup');
    setPopups(document.querySelector('.results__popup-btn'), '_resultsPopup');
    function animateOnScroll(element, animationClass, delay) {
      var options = {
        root: null,
        rootMargin: '0px',
        threshold: 0.2
      };
      var observer = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) {
            setTimeout(function () {
              entry.target.classList.add(animationClass);
            }, delay);
          } else {
            entry.target.classList.remove(animationClass);
          }
        });
      }, options);
      observer.observe(element);
    }
    animateOnScroll(resultsFirst.querySelector(".results__top-decor"), "_show", 0);
    animateOnScroll(resultsSecond.querySelector(".results__top-decor"), "_show", 400);
    animateOnScroll(resultsThird.querySelector(".results__top-decor"), "_show", 800);
    animateOnScroll(resultsFirst.querySelector(".results__top-wrap"), "_show", 0);
    animateOnScroll(resultsSecond.querySelector(".results__top-wrap"), "_show", 400);
    animateOnScroll(resultsThird.querySelector(".results__top-wrap"), "_show", 800);
    document.querySelectorAll('.bet__item').forEach(function (item) {
      var wrap = item.querySelector('.bet__wrap');
      var navItems = item.querySelectorAll('.bet__scroll-nav-item');
      var scrollCount = item.querySelector('.bet__scroll-count');
      var firstColumn = item.querySelector('.bet__column');
      var updateScrollStatus = function updateScrollStatus() {
        var scrollLeft = wrap.scrollLeft;
        var isFirstVisible = scrollLeft < firstColumn.clientWidth / 2;
        navItems[0].classList.toggle('_active', isFirstVisible);
        navItems[1].classList.toggle('_active', !isFirstVisible);
        scrollCount.textContent = isFirstVisible ? '1/2' : '2/2';
      };
      wrap.addEventListener('scroll', updateScrollStatus);
      updateScrollStatus();
    });
  });
  document.querySelector(".dark-btn").addEventListener("click", function () {
    document.body.classList.toggle("dark");
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsInNsaWRlTW92ZUxlZnQiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVNb3ZlUmlnaHQiLCJzbGlkZUNvdW50ZXIiLCJiZXRUYWJsZXMiLCJyZXN1bHRzRmlyc3QiLCJyZXN1bHRzU2Vjb25kIiwicmVzdWx0c1RoaXJkIiwiY3VycmVudFJhY2UiLCJmb3JFYWNoIiwic2xpZGUiLCJpIiwiY2xhc3NMaXN0IiwiYWRkIiwiY3VycmVudFNsaWRlIiwidXBkYXRlU2xpZGVyIiwiaW5kZXgiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsImxlbmd0aCIsInRhYmxlIiwibW92ZVNsaWRlIiwiZGlyZWN0aW9uIiwiY3VycmVudEJvbGlkIiwibmV4dFNsaWRlIiwibmV4dEJvbGlkIiwic2V0VGltZW91dCIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInN0YXJ0Q291bnRkb3duIiwiZW5kVGltZSIsImRheXNFbHMiLCJob3Vyc0VscyIsIm1pbnV0ZXNFbHMiLCJ1cGRhdGVUaW1lciIsIm5vdyIsIkRhdGUiLCJnZXRUaW1lIiwidGltZUxlZnQiLCJjbGVhckludGVydmFsIiwidGltZXJJbnRlcnZhbCIsInVwZGF0ZURpZ2l0cyIsImRheXMiLCJNYXRoIiwiZmxvb3IiLCJob3VycyIsIm1pbnV0ZXMiLCJTdHJpbmciLCJwYWRTdGFydCIsImVsZW1lbnRzIiwidmFsdWUiLCJzZXRJbnRlcnZhbCIsImVuZE9mTW9udGgiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwic3RhcnRTbW9rZSIsImNhclNlbGVjdG9yIiwic21va2VDbGFzcyIsIm1heENvdW50IiwiaW50ZXJ2YWwiLCJkZWxheSIsImZhZGVUaW1lIiwicmVtb3ZlRGVsYXkiLCJleHRyYUNsYXNzIiwiYWN0aXZlQ2xhc3MiLCJjYXJzIiwiY2FyIiwiY3JlYXRlU21va2UiLCJwYXJlbnQiLCJwYXJlbnRFbGVtZW50IiwiY29udGFpbnMiLCJleHRyYUNsYXNzTmFtZSIsInNtb2tlIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwic2V0UG9wdXBzIiwidHJpZ2dlckJ1dHRvbiIsInBvcHVwQ2xhc3MiLCJwb3B1cHNDb250YWluZXIiLCJwb3B1cCIsImJvZHkiLCJvdmVyZmxvdyIsImNsb3NlQnV0dG9uIiwiZSIsInRhcmdldCIsImNsb3NlUG9wdXAiLCJhbmltYXRlT25TY3JvbGwiLCJlbGVtZW50IiwiYW5pbWF0aW9uQ2xhc3MiLCJvcHRpb25zIiwicm9vdCIsInJvb3RNYXJnaW4iLCJ0aHJlc2hvbGQiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiZW50cmllcyIsImVudHJ5IiwiaXNJbnRlcnNlY3RpbmciLCJvYnNlcnZlIiwiaXRlbSIsIndyYXAiLCJuYXZJdGVtcyIsInNjcm9sbENvdW50IiwiZmlyc3RDb2x1bW4iLCJ1cGRhdGVTY3JvbGxTdGF0dXMiLCJzY3JvbGxMZWZ0IiwiaXNGaXJzdFZpc2libGUiLCJjbGllbnRXaWR0aCIsInRvZ2dsZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFlBQVc7RUFDUkEsUUFBUSxDQUFDQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxZQUFLO0lBQy9DLElBQU1DLE1BQU0sR0FBR0YsUUFBUSxDQUFDRyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUM7SUFDdkQsSUFBTUMsYUFBYSxHQUFHSixRQUFRLENBQUNLLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQztJQUMvRCxJQUFNQyxjQUFjLEdBQUdOLFFBQVEsQ0FBQ0ssYUFBYSxDQUFDLGtCQUFrQixDQUFDO0lBQ2pFLElBQU1FLFlBQVksR0FBR1AsUUFBUSxDQUFDSyxhQUFhLENBQUMsb0JBQW9CLENBQUM7SUFDakUsSUFBTUcsU0FBUyxHQUFHUixRQUFRLENBQUNHLGdCQUFnQixDQUFDLFlBQVksQ0FBQztJQUN6RCxJQUFNTSxZQUFZLEdBQUdULFFBQVEsQ0FBQ0ssYUFBYSxDQUFD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QixDQUFDO01BQy9ELElBQU11RyxXQUFXLEdBQUdILElBQUksQ0FBQ2xHLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQztNQUM1RCxJQUFNc0csV0FBVyxHQUFHSixJQUFJLENBQUNsRyxhQUFhLENBQUMsY0FBYyxDQUFDO01BRXRELElBQU11RyxrQkFBa0IsR0FBRyxTQUFyQkEsa0JBQWtCLEdBQVM7UUFDN0IsSUFBTUMsVUFBVSxHQUFHTCxJQUFJLENBQUNLLFVBQVU7UUFDbEMsSUFBTUMsY0FBYyxHQUFHRCxVQUFVLEdBQUdGLFdBQVcsQ0FBQ0ksV0FBVyxHQUFHLENBQUM7UUFFL0ROLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQ3pGLFNBQVMsQ0FBQ2dHLE1BQU0sQ0FBQyxTQUFTLEVBQUVGLGNBQWMsQ0FBQztRQUN2REwsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDekYsU0FBUyxDQUFDZ0csTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDRixjQUFjLENBQUM7UUFFeERKLFdBQVcsQ0FBQ3BGLFdBQVcsR0FBR3dGLGNBQWMsR0FBRyxLQUFLLEdBQUcsS0FBSztNQUM1RCxDQUFDO01BRUROLElBQUksQ0FBQ3ZHLGdCQUFnQixDQUFDLFFBQVEsRUFBRTJHLGtCQUFrQixDQUFDO01BQ25EQSxrQkFBa0IsRUFBRTtJQUN4QixDQUFDLENBQUM7RUFFTixDQUFDLENBQUM7RUFFRjVHLFFBQVEsQ0FBQ0ssYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDSixnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBSztJQUMvREQsUUFBUSxDQUFDb0YsSUFBSSxDQUFDcEUsU0FBUyxDQUFDZ0csTUFBTSxDQUFDLE1BQU0sQ0FBQztFQUMxQyxDQUFDLENBQUM7QUFDTixDQUFDLEdBQUciLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKXtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PntcbiAgICAgICAgY29uc3Qgc2xpZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yYWNlX19pdGVtXCIpXG4gICAgICAgIGNvbnN0IHNsaWRlTW92ZUxlZnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdi1sZWZ0XCIpXG4gICAgICAgIGNvbnN0IHNsaWRlTW92ZVJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXYtcmlnaHRcIilcbiAgICAgICAgY29uc3Qgc2xpZGVDb3VudGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXYtY291bnRlclwiKVxuICAgICAgICBjb25zdCBiZXRUYWJsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJldF9faXRlbVwiKVxuICAgICAgICBjb25zdCByZXN1bHRzRmlyc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX2ZpcnN0XCIpXG4gICAgICAgIGNvbnN0IHJlc3VsdHNTZWNvbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3NlY29uZFwiKVxuICAgICAgICBjb25zdCByZXN1bHRzVGhpcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3RoaXJkXCIpXG5cbiAgICAgICAgbGV0IGN1cnJlbnRSYWNlID0gMztcblxuICAgICAgICBzbGlkZXMuZm9yRWFjaCgoc2xpZGUsIGkpID0+e1xuICAgICAgICAgICAgaWYoaSA8IGN1cnJlbnRSYWNlKXtcbiAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QuYWRkKFwiX2RvbmVcIilcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGkgPiBjdXJyZW50UmFjZSl7XG4gICAgICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LmFkZChcIl9sb2NrXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cblxuICAgICAgICBsZXQgY3VycmVudFNsaWRlID0gY3VycmVudFJhY2VcblxuXG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlU2xpZGVyKGluZGV4KSB7XG4gICAgICAgICAgICBzbGlkZXMuZm9yRWFjaChzbGlkZSA9PiBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKFwiX2FjdGl2ZVwiKSk7XG4gICAgICAgICAgICBzbGlkZXNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoXCJfYWN0aXZlXCIpO1xuICAgICAgICAgICAgc2xpZGVDb3VudGVyLnRleHRDb250ZW50ID0gYCR7aW5kZXggKyAxfS8ke3NsaWRlcy5sZW5ndGh9YDtcbiAgICAgICAgICAgIGJldFRhYmxlcy5mb3JFYWNoKHRhYmxlID0+e1xuICAgICAgICAgICAgICAgIGlmKGN1cnJlbnRTbGlkZSA+IGN1cnJlbnRSYWNlKXtcbiAgICAgICAgICAgICAgICAgICAgdGFibGUuY2xhc3NMaXN0LmFkZChcIl9sb2NrXCIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKGN1cnJlbnRTbGlkZSA8IGN1cnJlbnRSYWNlKXtcbiAgICAgICAgICAgICAgICAgICAgdGFibGUuY2xhc3NMaXN0LmFkZChcIl9kb25lXCIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKGN1cnJlbnRTbGlkZSA9PT0gY3VycmVudFJhY2Upe1xuICAgICAgICAgICAgICAgICAgICB0YWJsZS5jbGFzc0xpc3QucmVtb3ZlKFwiX2xvY2tcIiwgXCJfZG9uZVwiKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtb3ZlU2xpZGUoZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Qm9saWQgPSBzbGlkZXNbY3VycmVudFNsaWRlXS5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX2JvbGlkXCIpO1xuICAgICAgICAgICAgY3VycmVudEJvbGlkLmNsYXNzTGlzdC5hZGQoXCJfbW92ZVwiKTtcbiAgICAgICAgICAgIGxldCBuZXh0U2xpZGUgPSBkaXJlY3Rpb24gPT09IFwibmV4dFwiID8gY3VycmVudFNsaWRlICsgMSA6IGN1cnJlbnRTbGlkZSAtIDE7XG4gICAgICAgICAgICBpZiAobmV4dFNsaWRlIDwgMCkgbmV4dFNsaWRlID0gc2xpZGVzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICBpZiAobmV4dFNsaWRlID49IHNsaWRlcy5sZW5ndGgpIG5leHRTbGlkZSA9IDA7XG5cbiAgICAgICAgICAgIGNvbnN0IG5leHRCb2xpZCA9IHNsaWRlc1tuZXh0U2xpZGVdLnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fYm9saWRcIik7XG4gICAgICAgICAgICBuZXh0Qm9saWQuY2xhc3NMaXN0LmFkZChcIl9hcnJpdmVcIik7XG5cblxuICAgICAgICAgICAgc2xpZGVzW2N1cnJlbnRTbGlkZV0uY2xhc3NMaXN0LmFkZChcIl9vcGFjaXR5XCIpXG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRCb2xpZC5jbGFzc0xpc3QucmVtb3ZlKFwiX21vdmVcIik7XG4gICAgICAgICAgICAgICAgbmV4dEJvbGlkLmNsYXNzTGlzdC5yZW1vdmUoXCJfYXJyaXZlXCIpO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRTbGlkZSA9IG5leHRTbGlkZTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZVNsaWRlcihjdXJyZW50U2xpZGUpO1xuICAgICAgICAgICAgICAgIHNsaWRlcy5mb3JFYWNoKHNsaWRlID0+e1xuICAgICAgICAgICAgICAgICAgICBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKFwiX29wYWNpdHlcIilcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSwgMTUwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBzbGlkZU1vdmVMZWZ0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBtb3ZlU2xpZGUoXCJwcmV2XCIpXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdlwiKS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX25hdlwiKS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCJcbiAgICAgICAgICAgIH0sIDIwMDApXG4gICAgICAgIH0pO1xuICAgICAgICBzbGlkZU1vdmVSaWdodC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbW92ZVNsaWRlKFwibmV4dFwiKVxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXZcIikuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXZcIikuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiXG4gICAgICAgICAgICB9LCAyMDAwKVxuICAgICAgICB9KTtcblxuICAgICAgICB1cGRhdGVTbGlkZXIoY3VycmVudFNsaWRlKTtcblxuXG5cblxuICAgICAgICBmdW5jdGlvbiBzdGFydENvdW50ZG93bihlbmRUaW1lKSB7XG4gICAgICAgICAgICBjb25zdCBkYXlzRWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50aW1lcl9fZGF5cy1pdGVtXCIpO1xuICAgICAgICAgICAgY29uc3QgaG91cnNFbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRpbWVyX19ob3Vycy1pdGVtXCIpO1xuICAgICAgICAgICAgY29uc3QgbWludXRlc0VscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGltZXJfX21pbnV0ZXMtaXRlbVwiKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVGltZXIoKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZUxlZnQgPSBlbmRUaW1lIC0gbm93O1xuXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVMZWZ0IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKGRheXNFbHMsIFwiMDBcIik7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhob3Vyc0VscywgXCIwMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKG1pbnV0ZXNFbHMsIFwiMDBcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBkYXlzID0gTWF0aC5mbG9vcih0aW1lTGVmdCAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKCh0aW1lTGVmdCAvICgxMDAwICogNjAgKiA2MCkpICUgMjQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKCh0aW1lTGVmdCAvICgxMDAwICogNjApKSAlIDYwKTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhkYXlzRWxzLCBTdHJpbmcoZGF5cykucGFkU3RhcnQoMiwgXCIwXCIpKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMoaG91cnNFbHMsIFN0cmluZyhob3VycykucGFkU3RhcnQoMiwgXCIwXCIpKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMobWludXRlc0VscywgU3RyaW5nKG1pbnV0ZXMpLnBhZFN0YXJ0KDIsIFwiMFwiKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZURpZ2l0cyhlbGVtZW50cywgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50c1swXS50ZXh0Q29udGVudCA9IHZhbHVlWzBdO1xuICAgICAgICAgICAgICAgIGVsZW1lbnRzWzFdLnRleHRDb250ZW50ID0gdmFsdWVbMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVwZGF0ZVRpbWVyKCk7XG4gICAgICAgICAgICBjb25zdCB0aW1lckludGVydmFsID0gc2V0SW50ZXJ2YWwodXBkYXRlVGltZXIsIDYwMDAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGVuZE9mTW9udGggPSBuZXcgRGF0ZShub3cuZ2V0RnVsbFllYXIoKSwgbm93LmdldE1vbnRoKCkgKyAxLCAwLCAyMywgNTkpLmdldFRpbWUoKTtcblxuICAgICAgICBzdGFydENvdW50ZG93bihlbmRPZk1vbnRoKTtcblxuXG4gICAgICAgIC8vIGZ1bmN0aW9uIHN0YXJ0U21va2UoY2FyU2VsZWN0b3IsIHNtb2tlQ2xhc3MsIG1heENvdW50LCBpbnRlcnZhbCwgZGVsYXksIGZhZGVUaW1lLCByZW1vdmVEZWxheSwgZXh0cmFDbGFzcyA9ICcnLCBhY3RpdmVDbGFzcyA9IGZhbHNlKSB7XG4gICAgICAgIC8vICAgICBjb25zdCBjYXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjYXJTZWxlY3Rvcik7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICBjYXJzLmZvckVhY2goY2FyID0+IHtcbiAgICAgICAgLy8gICAgICAgICBpZiAoIWNhcikgcmV0dXJuO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNtb2tlKCkge1xuICAgICAgICAvLyAgICAgICAgICAgICBpZiAoYWN0aXZlQ2xhc3MpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGlmICghY2FyLnBhcmVudEVsZW1lbnQgfHwgIWNhci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQgfHwgIWNhci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiX2FjdGl2ZVwiKSkgcmV0dXJuO1xuICAgICAgICAvLyAgICAgICAgICAgICB9XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICAgICAgICAgIGNvbnN0IGV4dHJhQ2xhc3NOYW1lID0gZXh0cmFDbGFzcyA/IGAuJHtleHRyYUNsYXNzfWAgOiAnJztcbiAgICAgICAgLy8gICAgICAgICAgICAgaWYgKGNhci5xdWVyeVNlbGVjdG9yQWxsKGAuJHtzbW9rZUNsYXNzfSR7ZXh0cmFDbGFzc05hbWV9YCkubGVuZ3RoIDwgbWF4Q291bnQpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGNvbnN0IHNtb2tlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBzbW9rZS5jbGFzc0xpc3QuYWRkKHNtb2tlQ2xhc3MpO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgaWYgKGV4dHJhQ2xhc3MpIHNtb2tlLmNsYXNzTGlzdC5hZGQoZXh0cmFDbGFzcyk7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBjYXIuYXBwZW5kQ2hpbGQoc21va2UpO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHNtb2tlLmNsYXNzTGlzdC5hZGQoXCJfb3BhY2l0eVwiKSwgZmFkZVRpbWUpO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHNtb2tlLnJlbW92ZSgpLCBmYWRlVGltZSArIHJlbW92ZURlbGF5KTtcbiAgICAgICAgLy8gICAgICAgICAgICAgfVxuICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgICAgICBjcmVhdGVTbW9rZSgpO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAvLyAgICAgICAgICAgICBzZXRJbnRlcnZhbChjcmVhdGVTbW9rZSwgaW50ZXJ2YWwpO1xuICAgICAgICAvLyAgICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3RhcnRTbW9rZShjYXJTZWxlY3Rvciwgc21va2VDbGFzcywgbWF4Q291bnQsIGludGVydmFsLCBkZWxheSwgZmFkZVRpbWUsIHJlbW92ZURlbGF5LCBleHRyYUNsYXNzID0gJycsIGFjdGl2ZUNsYXNzID0gZmFsc2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGNhcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNhclNlbGVjdG9yKTtcblxuICAgICAgICAgICAgY2Fycy5mb3JFYWNoKGNhciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFjYXIpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNtb2tlKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlQ2xhc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IGNhci5wYXJlbnRFbGVtZW50Py5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJlbnQgfHwgIXBhcmVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJfYWN0aXZlXCIpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBleHRyYUNsYXNzTmFtZSA9IGV4dHJhQ2xhc3MgPyBgLiR7ZXh0cmFDbGFzc31gIDogJyc7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYXIucXVlcnlTZWxlY3RvckFsbChgLiR7c21va2VDbGFzc30ke2V4dHJhQ2xhc3NOYW1lfWApLmxlbmd0aCA8IG1heENvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzbW9rZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc21va2UuY2xhc3NMaXN0LmFkZChzbW9rZUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHRyYUNsYXNzKSBzbW9rZS5jbGFzc0xpc3QuYWRkKGV4dHJhQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FyLmFwcGVuZENoaWxkKHNtb2tlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc21va2UucmVtb3ZlKCksIGZhZGVUaW1lICsgcmVtb3ZlRGVsYXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVNtb2tlKCk7XG4gICAgICAgICAgICAgICAgICAgIHNldEludGVydmFsKGNyZWF0ZVNtb2tlLCBpbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgfSwgZGVsYXkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWZyb250JywgNCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgdHJ1ZSk7XG4gICAgICAgIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtYmFjaycsIDgsIDkwMCwgNTAwLCAyMDAsIDE2MDAsIFwiXCIsIHRydWUpO1xuICAgICAgICBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWJhY2snLCA0LCA5MDAsIDUwMCwgMjAwLCAxNjAwLCBcIl9sYXJnZVwiLCB0cnVlKTtcbiAgICAgICAgc3RhcnRTbW9rZSgnLndlbGNvbWVfX3BlcnMtc21va2UtZnJvbnQnLCAnZnJvbnQtYmVmb3JlJywgNCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgZmFsc2UpO1xuICAgICAgICBzdGFydFNtb2tlKCcud2VsY29tZV9fcGVycy1zbW9rZS1iYWNrJywgJ2Zyb250LWJlZm9yZScsIDQsIDkwMCwgNTAwLCAyMDAsIDE2MDAsIFwiXCIsIGZhbHNlKTtcblxuXG4gICAgICAgIGZ1bmN0aW9uIHNldFBvcHVwcyh0cmlnZ2VyQnV0dG9uLCBwb3B1cENsYXNzKSB7XG4gICAgICAgICAgICBjb25zdCBwb3B1cHNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBzJyk7XG4gICAgICAgICAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5wb3B1cHNfX2l0ZW0uJHtwb3B1cENsYXNzfWApO1xuXG4gICAgICAgICAgICBpZiAoIXRyaWdnZXJCdXR0b24gfHwgIXBvcHVwIHx8ICFwb3B1cHNDb250YWluZXIpIHJldHVybjtcblxuICAgICAgICAgICAgdHJpZ2dlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBwb3B1cHNDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnX29wYWNpdHknKTtcbiAgICAgICAgICAgICAgICBwb3B1cHNDb250YWluZXIuY2xhc3NMaXN0LmFkZChwb3B1cENsYXNzKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwc19faXRlbS1jbG9zZScpO1xuXG4gICAgICAgICAgICBwb3B1cHNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PntcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQgPT09IHBvcHVwc0NvbnRhaW5lciB8fCBlLnRhcmdldCA9PT0gY2xvc2VCdXR0b24pe1xuICAgICAgICAgICAgICAgICAgICBjbG9zZVBvcHVwKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBjbG9zZVBvcHVwKCkge1xuICAgICAgICAgICAgICAgIHBvcHVwc0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdfb3BhY2l0eScpO1xuICAgICAgICAgICAgICAgIHBvcHVwc0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKHBvcHVwQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHNldFBvcHVwcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmV0X19idG4taXRlbScpLCAnX2JldFBvcHVwJyk7XG4gICAgICAgIHNldFBvcHVwcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29uZmlybV9fdXBkLWJ0bicpLCAnX2NvbmZpcm1Qb3B1cCcpO1xuICAgICAgICBzZXRQb3B1cHMoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc3VsdHNfX3BvcHVwLWJ0bicpLCAnX3Jlc3VsdHNQb3B1cCcpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGFuaW1hdGVPblNjcm9sbChlbGVtZW50LCBhbmltYXRpb25DbGFzcywgZGVsYXkpIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgcm9vdDogbnVsbCxcbiAgICAgICAgICAgICAgICByb290TWFyZ2luOiAnMHB4JyxcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGQ6IDAuMlxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICAgICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5hZGQoYW5pbWF0aW9uQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZGVsYXkpXG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKGFuaW1hdGlvbkNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCk7XG5cblxuICAgICAgICB9XG5cbiAgICAgICAgYW5pbWF0ZU9uU2Nyb2xsKHJlc3VsdHNGaXJzdC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3RvcC1kZWNvclwiKSwgXCJfc2hvd1wiLCAwKVxuICAgICAgICBhbmltYXRlT25TY3JvbGwocmVzdWx0c1NlY29uZC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdHNfX3RvcC1kZWNvclwiKSwgXCJfc2hvd1wiLCA0MDApXG4gICAgICAgIGFuaW1hdGVPblNjcm9sbChyZXN1bHRzVGhpcmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3AtZGVjb3JcIiksIFwiX3Nob3dcIiwgODAwKVxuICAgICAgICBhbmltYXRlT25TY3JvbGwocmVzdWx0c0ZpcnN0LnF1ZXJ5U2VsZWN0b3IoXCIucmVzdWx0c19fdG9wLXdyYXBcIiksIFwiX3Nob3dcIiwgMClcbiAgICAgICAgYW5pbWF0ZU9uU2Nyb2xsKHJlc3VsdHNTZWNvbmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3Atd3JhcFwiKSwgXCJfc2hvd1wiLCA0MDApXG4gICAgICAgIGFuaW1hdGVPblNjcm9sbChyZXN1bHRzVGhpcmQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRzX190b3Atd3JhcFwiKSwgXCJfc2hvd1wiLCA4MDApXG5cblxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYmV0X19pdGVtJykuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdyYXAgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5iZXRfX3dyYXAnKTtcbiAgICAgICAgICAgIGNvbnN0IG5hdkl0ZW1zID0gaXRlbS5xdWVyeVNlbGVjdG9yQWxsKCcuYmV0X19zY3JvbGwtbmF2LWl0ZW0nKTtcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbENvdW50ID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuYmV0X19zY3JvbGwtY291bnQnKTtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0Q29sdW1uID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuYmV0X19jb2x1bW4nKTtcblxuICAgICAgICAgICAgY29uc3QgdXBkYXRlU2Nyb2xsU3RhdHVzID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjcm9sbExlZnQgPSB3cmFwLnNjcm9sbExlZnQ7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNGaXJzdFZpc2libGUgPSBzY3JvbGxMZWZ0IDwgZmlyc3RDb2x1bW4uY2xpZW50V2lkdGggLyAyO1xuXG4gICAgICAgICAgICAgICAgbmF2SXRlbXNbMF0uY2xhc3NMaXN0LnRvZ2dsZSgnX2FjdGl2ZScsIGlzRmlyc3RWaXNpYmxlKTtcbiAgICAgICAgICAgICAgICBuYXZJdGVtc1sxXS5jbGFzc0xpc3QudG9nZ2xlKCdfYWN0aXZlJywgIWlzRmlyc3RWaXNpYmxlKTtcblxuICAgICAgICAgICAgICAgIHNjcm9sbENvdW50LnRleHRDb250ZW50ID0gaXNGaXJzdFZpc2libGUgPyAnMS8yJyA6ICcyLzInO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgd3JhcC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB1cGRhdGVTY3JvbGxTdGF0dXMpO1xuICAgICAgICAgICAgdXBkYXRlU2Nyb2xsU3RhdHVzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgfSlcblxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGFyay1idG5cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+e1xuICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoXCJkYXJrXCIpXG4gICAgfSlcbn0pKCkiXX0=
