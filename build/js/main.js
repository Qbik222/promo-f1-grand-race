"use strict";

(function () {
  document.addEventListener("DOMContentLoaded", function () {
    var slides = document.querySelectorAll(".race__item");
    var slideMoveLeft = document.querySelector(".race__nav-left");
    var slideMoveRight = document.querySelector(".race__nav-right");
    var slideCounter = document.querySelector(".race__nav-counter");
    var currentSlide = 0;
    function updateSlider(index) {
      slides.forEach(function (slide) {
        return slide.classList.remove("_active");
      });
      slides[index].classList.add("_active");
      slideCounter.textContent = "".concat(index + 1, "/").concat(slides.length);
    }
    function moveSlide(direction) {
      var currentBolid = slides[currentSlide].querySelector(".race__bolid");
      currentBolid.classList.add("_move");
      var nextSlide = direction === "next" ? currentSlide + 1 : currentSlide - 1;
      if (nextSlide < 0) nextSlide = slides.length - 1;
      if (nextSlide >= slides.length) nextSlide = 0;
      var nextBolid = slides[nextSlide].querySelector(".race__bolid");
      nextBolid.classList.add("_arrive");
      slides[currentSlide].classList.add("_opacity");
      setTimeout(function () {
        currentBolid.classList.remove("_move");
        nextBolid.classList.remove("_arrive");
        currentSlide = nextSlide;
        updateSlider(currentSlide);
        slides.forEach(function (slide) {
          slide.classList.remove("_opacity");
        });
      }, 1500);
    }
    slideMoveLeft.addEventListener("click", function () {
      return moveSlide("prev");
    });
    slideMoveRight.addEventListener("click", function () {
      return moveSlide("next");
    });
    updateSlider(currentSlide);
    function startCountdown(endTime) {
      var daysEls = document.querySelectorAll(".timer__days-item");
      var hoursEls = document.querySelectorAll(".timer__hours-item");
      var minutesEls = document.querySelectorAll(".timer__minutes-item");
      function updateTimer() {
        var now = new Date().getTime();
        var timeLeft = endTime - now;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          updateDigits(daysEls, "00");
          updateDigits(hoursEls, "00");
          updateDigits(minutesEls, "00");
          return;
        }
        var days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        var hours = Math.floor(timeLeft / (1000 * 60 * 60) % 24);
        var minutes = Math.floor(timeLeft / (1000 * 60) % 60);
        updateDigits(daysEls, String(days).padStart(2, "0"));
        updateDigits(hoursEls, String(hours).padStart(2, "0"));
        updateDigits(minutesEls, String(minutes).padStart(2, "0"));
      }
      function updateDigits(elements, value) {
        elements[0].textContent = value[0];
        elements[1].textContent = value[1];
      }
      updateTimer();
      var timerInterval = setInterval(updateTimer, 60000);
    }
    var now = new Date();
    var endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59).getTime();
    startCountdown(endOfMonth);
    function startSmoke(carSelector, smokeClass, maxCount, interval, delay, fadeTime, removeDelay) {
      var extraClass = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : '';
      var activeClass = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : false;
      var cars = document.querySelectorAll(carSelector);
      cars.forEach(function (car) {
        if (!car) return;
        console.log(car.parentElement.parentElement.classList.contains("_active"));
        function createSmoke() {
          if (activeClass) {
            if (!car || !car.parentElement.parentElement.classList.contains("_active")) return;
          }
          if (car.querySelectorAll(".".concat(smokeClass).concat(extraClass ? ".".concat(extraClass) : '')).length < maxCount) {
            var smoke = document.createElement('div');
            smoke.classList.add(smokeClass);
            if (extraClass) smoke.classList.add(extraClass);
            car.appendChild(smoke);
            setTimeout(function () {
              return smoke.classList.add("_opacity");
            }, fadeTime);
            setTimeout(function () {
              return smoke.remove();
            }, fadeTime + removeDelay);
          }
        }
        createSmoke();
        setTimeout(createSmoke, delay);
        setInterval(function () {
          createSmoke();
          setTimeout(createSmoke, delay);
        }, interval);
      });
    }
    // startSmoke('.race__bolid-car', 'race__bolid-smoke-front', 4, 900, 500, 100, 800, "", true);
    // startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 8, 900, 500, 100, 800, "", true);
    // startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 4, 900, 500, 100, 800, "_large", true);
    // startSmoke('.welcome__pers-smoke-front', 'front-before', 4, 900, 500, 100, 800, "", false);
    // startSmoke('.welcome__pers-smoke-back', 'front-before', 4, 900, 500, 100, 800, "", false);

    startSmoke('.race__bolid-car', 'race__bolid-smoke-front', 4, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 8, 900, 500, 200, 1600, "", true);
    startSmoke('.race__bolid-car', 'race__bolid-smoke-back', 4, 900, 500, 200, 1600, "_large", true);
    startSmoke('.welcome__pers-smoke-front', 'front-before', 4, 900, 500, 200, 1600, "", false);
    startSmoke('.welcome__pers-smoke-back', 'front-before', 4, 900, 500, 200, 1600, "", false);
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsInNsaWRlTW92ZUxlZnQiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVNb3ZlUmlnaHQiLCJzbGlkZUNvdW50ZXIiLCJjdXJyZW50U2xpZGUiLCJ1cGRhdGVTbGlkZXIiLCJpbmRleCIsImZvckVhY2giLCJzbGlkZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsInRleHRDb250ZW50IiwibGVuZ3RoIiwibW92ZVNsaWRlIiwiZGlyZWN0aW9uIiwiY3VycmVudEJvbGlkIiwibmV4dFNsaWRlIiwibmV4dEJvbGlkIiwic2V0VGltZW91dCIsInN0YXJ0Q291bnRkb3duIiwiZW5kVGltZSIsImRheXNFbHMiLCJob3Vyc0VscyIsIm1pbnV0ZXNFbHMiLCJ1cGRhdGVUaW1lciIsIm5vdyIsIkRhdGUiLCJnZXRUaW1lIiwidGltZUxlZnQiLCJjbGVhckludGVydmFsIiwidGltZXJJbnRlcnZhbCIsInVwZGF0ZURpZ2l0cyIsImRheXMiLCJNYXRoIiwiZmxvb3IiLCJob3VycyIsIm1pbnV0ZXMiLCJTdHJpbmciLCJwYWRTdGFydCIsImVsZW1lbnRzIiwidmFsdWUiLCJzZXRJbnRlcnZhbCIsImVuZE9mTW9udGgiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwic3RhcnRTbW9rZSIsImNhclNlbGVjdG9yIiwic21va2VDbGFzcyIsIm1heENvdW50IiwiaW50ZXJ2YWwiLCJkZWxheSIsImZhZGVUaW1lIiwicmVtb3ZlRGVsYXkiLCJleHRyYUNsYXNzIiwiYWN0aXZlQ2xhc3MiLCJjYXJzIiwiY2FyIiwiY29uc29sZSIsImxvZyIsInBhcmVudEVsZW1lbnQiLCJjb250YWlucyIsImNyZWF0ZVNtb2tlIiwic21va2UiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxZQUFXO0VBQ1JB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RSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDO0lBQzNGQSxVQUFVLENBQUMsa0JBQWtCLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDO0lBQzFGQSxVQUFVLENBQUMsa0JBQWtCLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDO0lBQ2hHQSxVQUFVLENBQUMsNEJBQTRCLEVBQUUsY0FBYyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQztJQUMzRkEsVUFBVSxDQUFDLDJCQUEyQixFQUFFLGNBQWMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUM7RUFFOUYsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxHQUFHIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCl7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT57XG4gICAgICAgIGNvbnN0IHNsaWRlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucmFjZV9faXRlbVwiKVxuICAgICAgICBjb25zdCBzbGlkZU1vdmVMZWZ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYWNlX19uYXYtbGVmdFwiKVxuICAgICAgICBjb25zdCBzbGlkZU1vdmVSaWdodCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2LXJpZ2h0XCIpXG4gICAgICAgIGNvbnN0IHNsaWRlQ291bnRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fbmF2LWNvdW50ZXJcIilcblxuICAgICAgICBsZXQgY3VycmVudFNsaWRlID0gMFxuXG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlU2xpZGVyKGluZGV4KSB7XG4gICAgICAgICAgICBzbGlkZXMuZm9yRWFjaChzbGlkZSA9PiBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKFwiX2FjdGl2ZVwiKSk7XG4gICAgICAgICAgICBzbGlkZXNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoXCJfYWN0aXZlXCIpO1xuICAgICAgICAgICAgc2xpZGVDb3VudGVyLnRleHRDb250ZW50ID0gYCR7aW5kZXggKyAxfS8ke3NsaWRlcy5sZW5ndGh9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG1vdmVTbGlkZShkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCb2xpZCA9IHNsaWRlc1tjdXJyZW50U2xpZGVdLnF1ZXJ5U2VsZWN0b3IoXCIucmFjZV9fYm9saWRcIik7XG4gICAgICAgICAgICBjdXJyZW50Qm9saWQuY2xhc3NMaXN0LmFkZChcIl9tb3ZlXCIpO1xuXG4gICAgICAgICAgICBsZXQgbmV4dFNsaWRlID0gZGlyZWN0aW9uID09PSBcIm5leHRcIiA/IGN1cnJlbnRTbGlkZSArIDEgOiBjdXJyZW50U2xpZGUgLSAxO1xuICAgICAgICAgICAgaWYgKG5leHRTbGlkZSA8IDApIG5leHRTbGlkZSA9IHNsaWRlcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgaWYgKG5leHRTbGlkZSA+PSBzbGlkZXMubGVuZ3RoKSBuZXh0U2xpZGUgPSAwO1xuXG4gICAgICAgICAgICBjb25zdCBuZXh0Qm9saWQgPSBzbGlkZXNbbmV4dFNsaWRlXS5xdWVyeVNlbGVjdG9yKFwiLnJhY2VfX2JvbGlkXCIpO1xuICAgICAgICAgICAgbmV4dEJvbGlkLmNsYXNzTGlzdC5hZGQoXCJfYXJyaXZlXCIpO1xuXG5cbiAgICAgICAgICAgIHNsaWRlc1tjdXJyZW50U2xpZGVdLmNsYXNzTGlzdC5hZGQoXCJfb3BhY2l0eVwiKVxuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Qm9saWQuY2xhc3NMaXN0LnJlbW92ZShcIl9tb3ZlXCIpO1xuICAgICAgICAgICAgICAgIG5leHRCb2xpZC5jbGFzc0xpc3QucmVtb3ZlKFwiX2Fycml2ZVwiKTtcbiAgICAgICAgICAgICAgICBjdXJyZW50U2xpZGUgPSBuZXh0U2xpZGU7XG5cbiAgICAgICAgICAgICAgICB1cGRhdGVTbGlkZXIoY3VycmVudFNsaWRlKTtcbiAgICAgICAgICAgICAgICBzbGlkZXMuZm9yRWFjaChzbGlkZSA9PntcbiAgICAgICAgICAgICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShcIl9vcGFjaXR5XCIpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sIDE1MDApO1xuICAgICAgICB9XG5cbiAgICAgICAgc2xpZGVNb3ZlTGVmdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gbW92ZVNsaWRlKFwicHJldlwiKSk7XG4gICAgICAgIHNsaWRlTW92ZVJpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBtb3ZlU2xpZGUoXCJuZXh0XCIpKTtcblxuICAgICAgICB1cGRhdGVTbGlkZXIoY3VycmVudFNsaWRlKTtcblxuXG5cblxuICAgICAgICBmdW5jdGlvbiBzdGFydENvdW50ZG93bihlbmRUaW1lKSB7XG4gICAgICAgICAgICBjb25zdCBkYXlzRWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50aW1lcl9fZGF5cy1pdGVtXCIpO1xuICAgICAgICAgICAgY29uc3QgaG91cnNFbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRpbWVyX19ob3Vycy1pdGVtXCIpO1xuICAgICAgICAgICAgY29uc3QgbWludXRlc0VscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGltZXJfX21pbnV0ZXMtaXRlbVwiKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVGltZXIoKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZUxlZnQgPSBlbmRUaW1lIC0gbm93O1xuXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVMZWZ0IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKGRheXNFbHMsIFwiMDBcIik7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhob3Vyc0VscywgXCIwMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGlnaXRzKG1pbnV0ZXNFbHMsIFwiMDBcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBkYXlzID0gTWF0aC5mbG9vcih0aW1lTGVmdCAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKCh0aW1lTGVmdCAvICgxMDAwICogNjAgKiA2MCkpICUgMjQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKCh0aW1lTGVmdCAvICgxMDAwICogNjApKSAlIDYwKTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZURpZ2l0cyhkYXlzRWxzLCBTdHJpbmcoZGF5cykucGFkU3RhcnQoMiwgXCIwXCIpKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMoaG91cnNFbHMsIFN0cmluZyhob3VycykucGFkU3RhcnQoMiwgXCIwXCIpKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVEaWdpdHMobWludXRlc0VscywgU3RyaW5nKG1pbnV0ZXMpLnBhZFN0YXJ0KDIsIFwiMFwiKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZURpZ2l0cyhlbGVtZW50cywgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50c1swXS50ZXh0Q29udGVudCA9IHZhbHVlWzBdO1xuICAgICAgICAgICAgICAgIGVsZW1lbnRzWzFdLnRleHRDb250ZW50ID0gdmFsdWVbMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVwZGF0ZVRpbWVyKCk7XG4gICAgICAgICAgICBjb25zdCB0aW1lckludGVydmFsID0gc2V0SW50ZXJ2YWwodXBkYXRlVGltZXIsIDYwMDAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGVuZE9mTW9udGggPSBuZXcgRGF0ZShub3cuZ2V0RnVsbFllYXIoKSwgbm93LmdldE1vbnRoKCkgKyAxLCAwLCAyMywgNTkpLmdldFRpbWUoKTtcblxuICAgICAgICBzdGFydENvdW50ZG93bihlbmRPZk1vbnRoKTtcblxuICAgICAgICBmdW5jdGlvbiBzdGFydFNtb2tlKGNhclNlbGVjdG9yLCBzbW9rZUNsYXNzLCBtYXhDb3VudCwgaW50ZXJ2YWwsIGRlbGF5LCBmYWRlVGltZSwgcmVtb3ZlRGVsYXksIGV4dHJhQ2xhc3MgPSAnJywgYWN0aXZlQ2xhc3MgPSBmYWxzZSkge1xuICAgICAgICAgICAgY29uc3QgY2FycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY2FyU2VsZWN0b3IpO1xuICAgICAgICAgICAgY2Fycy5mb3JFYWNoKGNhciA9PntcbiAgICAgICAgICAgICAgICBpZiAoIWNhcikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNhci5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiX2FjdGl2ZVwiKSlcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNtb2tlKCkge1xuICAgICAgICAgICAgICAgICAgICBpZihhY3RpdmVDbGFzcyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNhciB8fCAhY2FyLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJfYWN0aXZlXCIpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhci5xdWVyeVNlbGVjdG9yQWxsKGAuJHtzbW9rZUNsYXNzfSR7ZXh0cmFDbGFzcyA/IGAuJHtleHRyYUNsYXNzfWAgOiAnJ31gKS5sZW5ndGggPCBtYXhDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc21va2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNtb2tlLmNsYXNzTGlzdC5hZGQoc21va2VDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXh0cmFDbGFzcykgc21va2UuY2xhc3NMaXN0LmFkZChleHRyYUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhci5hcHBlbmRDaGlsZChzbW9rZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHNtb2tlLmNsYXNzTGlzdC5hZGQoXCJfb3BhY2l0eVwiKSwgZmFkZVRpbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBzbW9rZS5yZW1vdmUoKSwgZmFkZVRpbWUgKyByZW1vdmVEZWxheSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY3JlYXRlU21va2UoKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNyZWF0ZVNtb2tlLCBkZWxheSk7XG4gICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVTbW9rZSgpO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNyZWF0ZVNtb2tlLCBkZWxheSk7XG4gICAgICAgICAgICAgICAgfSwgaW50ZXJ2YWwpO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICB9XG4gICAgICAgIC8vIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtZnJvbnQnLCA0LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiXCIsIHRydWUpO1xuICAgICAgICAvLyBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWJhY2snLCA4LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiXCIsIHRydWUpO1xuICAgICAgICAvLyBzdGFydFNtb2tlKCcucmFjZV9fYm9saWQtY2FyJywgJ3JhY2VfX2JvbGlkLXNtb2tlLWJhY2snLCA0LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiX2xhcmdlXCIsIHRydWUpO1xuICAgICAgICAvLyBzdGFydFNtb2tlKCcud2VsY29tZV9fcGVycy1zbW9rZS1mcm9udCcsICdmcm9udC1iZWZvcmUnLCA0LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiXCIsIGZhbHNlKTtcbiAgICAgICAgLy8gc3RhcnRTbW9rZSgnLndlbGNvbWVfX3BlcnMtc21va2UtYmFjaycsICdmcm9udC1iZWZvcmUnLCA0LCA5MDAsIDUwMCwgMTAwLCA4MDAsIFwiXCIsIGZhbHNlKTtcblxuXG4gICAgICAgIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtZnJvbnQnLCA0LCA5MDAsIDUwMCwgMjAwLCAxNjAwLCBcIlwiLCB0cnVlKTtcbiAgICAgICAgc3RhcnRTbW9rZSgnLnJhY2VfX2JvbGlkLWNhcicsICdyYWNlX19ib2xpZC1zbW9rZS1iYWNrJywgOCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgdHJ1ZSk7XG4gICAgICAgIHN0YXJ0U21va2UoJy5yYWNlX19ib2xpZC1jYXInLCAncmFjZV9fYm9saWQtc21va2UtYmFjaycsIDQsIDkwMCwgNTAwLCAyMDAsIDE2MDAsIFwiX2xhcmdlXCIsIHRydWUpO1xuICAgICAgICBzdGFydFNtb2tlKCcud2VsY29tZV9fcGVycy1zbW9rZS1mcm9udCcsICdmcm9udC1iZWZvcmUnLCA0LCA5MDAsIDUwMCwgMjAwLCAxNjAwLCBcIlwiLCBmYWxzZSk7XG4gICAgICAgIHN0YXJ0U21va2UoJy53ZWxjb21lX19wZXJzLXNtb2tlLWJhY2snLCAnZnJvbnQtYmVmb3JlJywgNCwgOTAwLCA1MDAsIDIwMCwgMTYwMCwgXCJcIiwgZmFsc2UpO1xuXG4gICAgfSlcbn0pKCkiXX0=
